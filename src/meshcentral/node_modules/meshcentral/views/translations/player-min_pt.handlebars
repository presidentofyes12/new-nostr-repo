<!doctypehtml><html lang=pt dir=ltr xmlns=http://www.w3.org/1999/xhtml><meta http-equiv=X-UA-Compatible content="IE=edge"><meta content="text/html;charset=utf-8"http-equiv=Content-Type><meta name=viewport content="user-scalable=1,initial-scale=1,minimum-scale=1,maximum-scale=1"><meta name=apple-mobile-web-app-capable content=yes><meta name=format-detection content="telephone=no"><meta name=robots content=noindex,nofollow><link type=text/css href=styles/style.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/xterm.css media=screen rel=stylesheet title=CSS><link rel=apple-touch-icon href=/favicon-303x303.png><script src=scripts/common-0.0.1{{min}}.js></script><script src=scripts/agent-desktop-0.0.2{{min}}.js></script><script src=scripts/amt-desktop-0.0.2{{min}}.js></script><script src=scripts/amt-terminal-0.0.2{{min}}.js></script><script src=scripts/zlib{{min}}.js></script><script src=scripts/zlib-inflate{{min}}.js></script><script src=scripts/zlib-adler32{{min}}.js></script><script src=scripts/zlib-crc32{{min}}.js></script><script src=scripts/xterm-min.js></script><script src=scripts/xterm-addon-fit-min.js></script><script keeplink=1 src=scripts/webm-writer.js></script><script keeplink=1 src=scripts/filesaver.min.js></script><body style=overflow:hidden;background-color:#000><div id=p11 class=noselect style=overflow:hidden><div id=deskarea0><div id=deskarea1 class=areaHead><div class=toright2><div class=deskareaicon title="Alternar modo de exibição"onclick=toggleAspectRatio(1)>⇲</div>&nbsp; <input id=ConvertAsWebM style=display:none type=button value="Converter para WebM"onclick=saveAsWebMfile()>&nbsp;</div><div><input id=OpenFileButton type=button value="Abrir arquivo..."onclick=openfile() style=display:none> <span id=deskstatus style=line-height:22px;overflow:hidden;max-height:22px></span></div></div><div id=deskarea3x style="max-height:calc(100vh - 58px);height:calc(100vh - 58px)"onclick=togglePause()><div id=bigok style="display:none;left:calc((100vh / 2))"><b>✓</b></div><div id=bigfail style="display:none;left:calc((100vh / 2))"><b>✗</b></div><div id=metadatadiv style=padding:20px;color:#d3d3d3;text-align:left;display:none></div><div id=DeskParent><canvas id=Desk width=640 height=480></canvas></div><div id=TermParent style=display:none><pre id=Term></pre></div><div id=XTermParent style="display:none;overflow:scroll;max-height:calc(100vh - 58px);height:calc(100vh - 58px);text-align:left"></div><div id=p11DeskConsoleMsg style=display:none;cursor:pointer;position:absolute;left:30px;top:17px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px onclick=clearConsoleMsg()></div></div><div id=deskarea2><div class=areaProgress style=cursor:pointer onclick=progressBarSeek(event)><div id=progressbar style=height:6px;cursor:pointer></div></div></div><div id=deskarea4 class=areaFoot><div class=toright2><div id=timespan style=padding-top:4px;padding-right:4px>00:00:00</div></div><div>&nbsp; <input id=PlayButton type=button value=Play disabled onclick=play()> <input id=PauseButton type=button value=Pausa disabled onclick=pause()> <input id=RestartButton type=button value=Reiniciar disabled onclick=restart()> <select id=PlaySpeed onchange=this.blur()><option value=4>1/4 de velocidade<option value=2>1/2 velocidade<option value=1 selected>Velocidade normal<option value=0.5>2x velocidade<option value=0.25>4x velocidade<option value=0.1>10x Velocidade</select> <input id=SeekBackwardButton type=button value="<<"disabled onclick=seekBackward()> <input id=SeekForwardButton type=button value=">>"disabled onclick=seekForward()></div></div></div><div id=dialog class=noselect style=display:none><div id=dialogHeader><div tabindex=0 id=id_dialogclose onclick=setDialogMode() onkeypress='"Enter"==event.key&&setDialogMode()'>✖</div><div id=id_dialogtitle></div></div><div id=dialogBody><div id=dialog1><div id=id_dialogMessage></div></div><div id=dialog2><div id=id_dialogOptions></div></div></div><div id=idx_dlgButtonBar><input id=idx_dlgCancelButton type=button value=Cancelar onclick=dialogclose(0)> <input id=idx_dlgOkButton type=button value=Ok onclick=dialogclose(1)><div><input id=idx_dlgDeleteButton type=button value=Deletar style=display:none onclick=dialogclose(2)></div></div></div></div><script>var urlargs,random="{{{randomlength}}}",recFile=null,recFilePtr=0,recFileStartTime=0,recFileLastTime=0,recFileEndTime=0,recFileMetadata=null,recFileProtocol=0,recFileIndexBasePtr=null,recFileExtras=null,agentDesktop=null,amtDesktop=null,playing=!1,readState=0,waitTimer=null,waitTimerArgs=null,deskAspectRatio=0,currentDeltaTimeTotalSec=0,videoWriter=null,videoWriterLastFrame=null,videoWriterCurrentFrame=null,videoFrameDuration=100,browser=null,domainUrl="{{{domainurl}}}",term=null,ws=null,streamingBlockSize=102400,streamingBlockCache={};function start(){browser=function(e){switch(!0){case-1<e.indexOf("borda"):return"MS Edge (EdgeHtml)";case-1<e.indexOf("borda"):return"MS Edge Chromium";case-1<e.indexOf("opr")&&!!window.opr:return"ópera";case-1<e.indexOf("Chrome")&&!!window.chrome:return"Chrome";case-1<e.indexOf("tridente"):return"Internet Explorer";case-1<e.indexOf("Raposa de fogo"):return"Raposa de fogo";case-1<e.indexOf("safári"):return"safári";default:return"de outros"}}(window.navigator.userAgent.toLowerCase()),urlargs=parseUriArgs(!0),window.onresize=deskAdjust,document.ondrop=ondrop,document.ondragover=ondragover,document.ondragleave=ondragleave,document.onkeypress=onkeypress,Q("PlaySpeed").value=1,cleanup(),dialogBoxDrag(),null!=urlargs.stream?(QV("metadatadiv",!0),QH("metadatadiv","Conectando ao servidor..."),(ws=new WebSocket(window.location.protocol.replace("http","ws")+"//"+window.location.host+domainUrl+"recordings.ashx?file="+urlargs.stream+(urlargs.key?"&key="+urlargs.key:""))).binaryType="arraybuffer",ws.onopen=function(e){console.log("Session Streaming - Connected")},ws.onmessage=function(e){if("string"!=typeof e.data){var t,a=new Uint8Array(e.data),r=((a[4]<<24)+(a[5]<<16)+(a[6]<<8)+a[7])/streamingBlockSize,i=(streamingBlockCache[r]=e.data,[]),n=[];for(t in pendingFetchStreamingData)0<=pendingFetchStreamingData[t].missingBlocks.indexOf(r)&&pendingFetchStreamingData[t].missingBlocks.splice(t,1),(0==pendingFetchStreamingData[t].missingBlocks.length?n:i).push(pendingFetchStreamingData[t]);for(t in pendingFetchStreamingData=i,n)fetchStreamingData(n[t].fr,n[t].start,n[t].end)}else{a=null;try{a=JSON.parse(e.data)}catch(e){return void console.log(e)}null!=a&&"string"==typeof a.action&&"info"===a.action&&(console.log("Session Streaming - Session file size: "+a.size),"string"==typeof a.name)&&"number"==typeof a.size&&(recFile={name:a.name,size:a.size,streaming:!0},readLastBlock(function(e,t,a,r){3==e?(recFileEndTime=a,recFileExtras=r,readNextBlock(processFirstBlock)):recFileEndTime=0}))}},ws.onclose=function(e){console.log("Session Streaming - Disconnected"),ws=null,urlargs.stream=null,QV("OpenFileButton",!0),cleanup()}):QV("OpenFileButton",!0)}var pendingFetchStreamingData=[];function fetchStreamingData(e,t,a){for(var r=Math.floor(t/streamingBlockSize),i=Math.floor(a/streamingBlockSize),n=[],o=r;o<=i;o++)null!=streamingBlockCache[o]&&1!==streamingBlockCache[o]||(n.push(o),fetchStreamingBlock(o)),fetchStreamingBlock(o+1),fetchStreamingBlock(o+2);if(0==n.length){for(var l=0,s=new ArrayBuffer(a-t),d=new Uint8Array(s),o=r;o<=i;o++){var c=streamingBlockCache[o],u=o*streamingBlockSize,p=u+(c.byteLength-8),m=Math.max(t,u),u=m-u,p=Math.min(a,p)-m,m=c.slice(8+u,8+u+p);d.set(new Uint8Array(m),l),l+=p}e.onload({target:{result:ArrayBufferToString(s)}})}else pendingFetchStreamingData.push({fr:e,start:t,end:a,missingBlocks:n})}function fetchStreamingBlock(e){var t;null!=streamingBlockCache[e]||(streamingBlockCache[e]=1,e*streamingBlockSize>=recFile.size)||((e+1)*(t=streamingBlockSize)>=recFile.size&&(t=recFile.size-e*streamingBlockSize),ws.send('{"action":"get","ptr":'+e*streamingBlockSize+',"size":'+t+"}"))}function readNextBlock(n){var e;recFilePtr+16>recFile.size?(QS("progressbar").width="100%",n(-1)):((e=new FileReader).onload=function(e){var e=e.target.result,t=ReadShort(e,0),a=ReadShort(e,2),r=ReadInt(e,4),i=(ReadInt(e,8)<<32)+ReadInt(e,12);recFilePtr+16+r>recFile.size?(QS("progressbar").width="100%",n(-1)):((e=new FileReader).onload=function(e){e=e.target.result;recFilePtr+=16+r,QS("progressbar").width=0==recFileEndTime?Math.floor(recFilePtr/recFile.size*100)+"%":Math.floor((recFileLastTime-recFileStartTime)/(recFileEndTime-recFileStartTime)*100)+"%",n(t,a,i,e)},null==ws?e.readAsBinaryString(recFile.slice(recFilePtr+16,recFilePtr+16+r)):fetchStreamingData(e,recFilePtr+16,recFilePtr+16+r))},null==ws?e.readAsBinaryString(recFile.slice(recFilePtr,recFilePtr+16)):fetchStreamingData(e,recFilePtr,recFilePtr+16))}function readBlockAt(n,o){var e=new FileReader;e.onload=function(e){var e=e.target.result,t=ReadShort(e,0),a=ReadShort(e,2),r=ReadInt(e,4),i=(ReadInt(e,8)<<32)+ReadInt(e,12);n+16+r>recFile.size?o(-1):((e=new FileReader).onload=function(e){e=e.target.result;o(t,a,i,e)},null==ws?e.readAsBinaryString(recFile.slice(n+16,n+16+r)):fetchStreamingData(e,n+16,n+16+r))},null==ws?e.readAsBinaryString(recFile.slice(n,n+16)):fetchStreamingData(e,n,n+16)}function readLastBlock(o){var e;recFile.size<32?o(-1):((e=new FileReader).onload=function(e){var t,e=e.target.result,a=ReadShort(e,0),r=ReadShort(e,2),i=ReadInt(e,4),n=(ReadInt(e,8)<<32)+ReadInt(e,12),e=e.substring(16,32);3==a&&16==i&&"MeshCentralMCNDX"==e?((t=new FileReader).onload=function(e){var e=e.target.result,t=(ReadShort(e,0),ReadShort(e,2),ReadInt(e,4),(ReadInt(e,8)<<32)+ReadInt(e,12)),e=JSON.parse(e.substring(16));o(a,r,t,e)},null==ws?t.readAsBinaryString(recFile.slice(n,recFile.size-32)):fetchStreamingData(t,n,recFile.size-32)):3==a&&16==i&&"MeshCentralMCREC"==e?o(a,r,n):o(-1)},null==ws?e.readAsBinaryString(recFile.slice(recFile.size-32,recFile.size)):fetchStreamingData(e,recFile.size-32,recFile.size))}function addInfo(e,t){return null==t?"":addInfoNoEsc(e,EscapeHtml(t))}function addInfoNoEsc(e,t){return null==t?"":"<span style=color:gray>"+EscapeHtml(e)+"</span>:&nbsp;<span style=font-size:20px>"+t+"</span><br/>"}function processFirstBlock(e,t,a,r){if(recFileProtocol=0,1!=e||2<t)cleanup();else{try{recFileMetadata=JSON.parse(r)}catch(e){return void cleanup()}if(null==recFileMetadata||"MeshCentralRelaySession"!=recFileMetadata.magic||1!=recFileMetadata.ver)cleanup();else{if(recFileExtras)for(var i in recFileExtras)recFileMetadata[i]=recFileExtras[i];e="",t=(e+=addInfo("Tempo",recFileMetadata.time),0!=recFileEndTime&&(e+=addInfo("Duração",format("{0} segundo{1}",t=Math.floor((recFileEndTime-a)/1e3),1<t?"s":""))),e=(e=(e+=addInfo("Nome de usuário",recFileMetadata.username))+addInfo("ID do usuário",recFileMetadata.userid))+addInfo("ID da sessão",recFileMetadata.sessionid),recFileMetadata.ipaddr1&&recFileMetadata.ipaddr2&&(e+=addInfo("Endereços",format("{0} para {1}",recFileMetadata.ipaddr1,recFileMetadata.ipaddr2))),recFileMetadata.devicename&&(e+=addInfo("Nome do Dispositivo",recFileMetadata.devicename)),e+=addInfo("NodeID",recFileMetadata.nodeid),recFileMetadata.protocol&&(1==(r=recFileMetadata.protocol)?r="MeshCentral Terminal":2==r?r="MeshCentral Desktop":100==r?r="Intel&reg; AMT WSMAN":101==r?r="Intel&reg; Redirecionamento AMT":200==r&&(r="Intel&reg; AMT KVM"),e+=addInfoNoEsc("Protocolo",r)),"2 bytes por pixel");1==recFileMetadata.bpp&&(t="1 byte por pixel"),recFileMetadata.graymode&&(recFileMetadata.lowcolor?t+=", 16 cinza":t+=", 256 cinza"),e+=addInfoNoEsc("Qualidade de codificação",t),recFileMetadata.indexInterval?(recFileIndexBasePtr=recFilePtr,e+=addInfoNoEsc("Procurando",format("Indexado a cada {0} segundos",recFileMetadata.indexInterval)),QV("SeekBackwardButton",!0),QV("SeekForwardButton",!0),QE("SeekBackwardButton",!0),QE("SeekForwardButton",!0)):(QV("SeekBackwardButton",!1),QV("SeekForwardButton",!1)),QV("DeskParent",!0),QV("TermParent",!1),QV("XTermParent",!1),QV("ConvertAsWebM",!1),1==recFileMetadata.protocol?(recFileProtocol=1,e+="<br /><br /><span style=color:gray>Pressione [espaço] para reproduzir / pausar.</span>",QE("PlayButton",!0),QE("PauseButton",!1),QE("RestartButton",!1),recFileStartTime=recFileLastTime=a):2==recFileMetadata.protocol?(recFileProtocol=2,e+="<br /><br /><span style=color:gray>Pressione [espaço] para reproduzir / pausar.</span>",QE("PlayButton",!0),QE("PauseButton",!1),QE("RestartButton",!1),recFileStartTime=recFileLastTime=a,(agentDesktop=CreateAgentRemoteDesktop("Desk")).onScreenSizeChange=deskAdjust,agentDesktop.onPreDrawImage=preCanvasDraw,agentDesktop.State=3,deskAdjust(),QV("ConvertAsWebM","chrome"==browser)):101==recFileMetadata.protocol?(recFileProtocol=101,e+="<br /><br /><span style=color:gray>Pressione [espaço] para reproduzir / pausar.</span>",QE("PlayButton",!0),QE("PauseButton",!1),QE("RestartButton",!1),recFileStartTime=recFileLastTime=a,(amtDesktop=CreateAmtRemoteDesktop("Desk")).onScreenSizeChange=deskAdjust,amtDesktop.onPreDrawImage=preCanvasDraw,recFileMetadata.screenSize&&(amtDesktop.width=recFileMetadata.screenSize[0],amtDesktop.height=recFileMetadata.screenSize[1]),recFileMetadata.bpp&&(amtDesktop.bpp=recFileMetadata.bpp),recFileMetadata.graymode&&(amtDesktop.graymode=recFileMetadata.graymode),recFileMetadata.lowcolor&&(amtDesktop.lowcolor=recFileMetadata.lowcolor),amtDesktop.State=3,amtDesktop.Start(),deskAdjust()):200==recFileMetadata.protocol&&(recFileProtocol=200,e+="<br /><br /><span style=color:gray>Pressione [espaço] para reproduzir / pausar.</span>",QE("PlayButton",!0),QE("PauseButton",!1),QE("RestartButton",!1),recFileStartTime=recFileLastTime=a,(amtDesktop=CreateAmtRemoteDesktop("Desk")).onScreenSizeChange=deskAdjust,amtDesktop.onPreDrawImage=preCanvasDraw,amtDesktop.State=3,amtDesktop.Start(),recFileMetadata.screenSize&&(amtDesktop.width=recFileMetadata.screenSize[0],amtDesktop.height=recFileMetadata.screenSize[1]),recFileMetadata.bpp&&(amtDesktop.bpp=recFileMetadata.bpp),recFileMetadata.graymode&&(amtDesktop.graymode=recFileMetadata.graymode),recFileMetadata.lowcolor&&(amtDesktop.lowcolor=recFileMetadata.lowcolor),amtDesktop.state=3,deskAdjust(),QV("ConvertAsWebM","chrome"==browser)),QV("metadatadiv",!0),QH("metadatadiv",e),QH("deskstatus",recFile.name),QS("progressbar").width="0px"}}}function processBlock(e,t,a,r){var i;e<0?pause():(i=Math.round((a-recFileLastTime)*parseFloat(Q("PlaySpeed").value)))<5||null!=videoWriter?processBlockEx(e,t,a,r):(waitTimerArgs=[e,t,a,r],waitTimer=setTimeout(function(){waitTimer=null,waitTimerArgs&&processBlockEx(waitTimerArgs[0],waitTimerArgs[1],waitTimerArgs[2],waitTimerArgs[3])},i))}function processBlockEx(e,t,a,r,i){if(0!=playing||!0===i){var n,i=0!=(1&t),t=0!=(2&t);if(3==e&&null!=videoWriter&&(preCanvasDraw(),videoWriter.complete().then(function(e){saveAs(e,recFile.name.replace(".mcrec",".webm")),videoWriter=null,QE("PlaySpeed",!0),QE("SeekBackwardButton",!0),QE("SeekForwardButton",!0),QE("ConvertAsWebM",!0),QE("OpenFileButton",!0)})),2==e&&(recFileLastTime=a,c=Math.floor((a-recFileStartTime)/1e3),currentDeltaTimeTotalSec!=c&&(currentDeltaTimeTotalSec=c,o=Math.floor(c/3600),d=Math.floor(c%3600/60),c=Math.floor(c%60),QH("timespan",pad2(o)+":"+pad2(d)+":"+pad2(c))),null==videoWriterLastFrame&&(videoWriterLastFrame=a),videoWriterCurrentFrame=a),2==e&&!i&&t&&2<r.length&&"{"==r[0]){var o=null;try{o=JSON.parse(r)}catch(e){}null==o||"options"!=o.type&&"termsize"!=o.type||"number"!=typeof o.cols||"number"!=typeof o.rows||term.resize(o.cols,o.rows)}if(2==e&&i&&!t){if(1==recFileProtocol)writeXTerm(r);else if(2==recFileProtocol){for(var l=new Uint8Array(r.length),s=0;s<r.length;s++)l[s]=r.charCodeAt(s);var d=(l[0]<<8)+l[1],c=(l[2]<<8)+l[3];27==d&&8==c&&(d=(l[8]<<8)+l[9],c=(l[5]<<16)+(l[6]<<8)+l[7],l=l.slice(8)),c!=l.byteLength?console.log("Bad command size",d,c,l.byteLength):agentDesktop.ProcessBinaryCommand(d,c,l.slice(0,c))}else if(101==recFileProtocol){for(l=new Uint8Array(r.length),s=0;s<r.length;s++)l[s]=r.charCodeAt(s);0==readState&&"4100000000000000"==rstr2hex(r)?(readState=1,8<r.length&&amtDesktop.ProcessBinaryData(l.slice(8).buffer)):1==readState&&amtDesktop.ProcessBinaryData(l.buffer)}else if(200==recFileProtocol){for(l=new Uint8Array(r.length),s=0;s<r.length;s++)l[s]=r.charCodeAt(s);amtDesktop.ProcessBinaryData(l.buffer)}}else 2==e&&i&&t&&101==recFileProtocol&&("0000000008080001000700070003050200000000"==rstr2hex(r)&&(console.log("RGB8"),amtDesktop.bpp=1),"000000000808000100FF00000000000000000000"==rstr2hex(r)&&(console.log("GRAY8"),amtDesktop.bpp=1,obj.graymode=!0),"0000000008040001000F00000000000000000000"==rstr2hex(r))&&(console.log("GRAY4"),amtDesktop.bpp=1,obj.graymode=!0,obj.lowcolor=!0);3==e&&200==recFileProtocol&&((n=new Image).src="dados: imagem / png; base64,"+btoa(r),n.onload=function(){amtDesktop.canvas.drawImage(n,0,0)},n.error=function(){}),playing&&readNextBlock(processBlock)}}function cleanup(){clearXTerm(),recFilePtr=0,playing=!1,(recFileMetadata=recFile=null)!=agentDesktop&&(agentDesktop.Canvas.clearRect(0,0,agentDesktop.CanvasId.width,agentDesktop.CanvasId.height),agentDesktop=null),null!=amtDesktop&&(amtDesktop.canvas.clearRect(0,0,amtDesktop.CanvasId.width,amtDesktop.CanvasId.height),amtDesktop=null),recFileEndTime=currentDeltaTimeTotalSec=readState=0,(agentTerminal=waitTimerArgs=null)!=waitTimer&&(clearTimeout(waitTimer),waitTimer=null),QH("deskstatus",""),QE("PlayButton",!1),QE("PauseButton",!1),QE("RestartButton",!1),QE("SeekBackwardButton",!1),QE("SeekForwardButton",!1),QS("progressbar").width="0px",QH("timespan","00:00:00"),QV("metadatadiv",!0),null==urlargs.stream?QH("metadatadiv",'<span style="font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:28px">MeshCentral Session Player</span><br /><br /><span style=color:gray>Arraste e solte um arquivo .mcrec ou clique em "Abrir arquivo..."</span>'):QH("metadatadiv",""),QV("DeskParent",!0),QV("TermParent",!1),QV("XTermParent",!1)}function ondrop(e){if(!xxdialogMode&&(haltEvent(e),QV("bigfail",!1),QV("bigok",!1),null!=e.dataTransfer)){var t,a=[];for(t in e.dataTransfer.files)null!=e.dataTransfer.files[t].type&&null!=e.dataTransfer.files[t].size&&0!=e.dataTransfer.files[t].size&&e.dataTransfer.files[t].name.endsWith(".mcrec")&&a.push(e.dataTransfer.files[t]);0!=a.length&&(cleanup(),recFile=a[0],recFilePtr=0,readLastBlock(function(e,t,a,r){3==e?(recFileEndTime=a,recFileExtras=r,readNextBlock(processFirstBlock)):recFileEndTime=0}))}}var SeekIndex,SeekIndexPtr,SeekIndexTime,SeekPlayState,dragtimer=null;function ondragover(e){xxdialogMode||(haltEvent(e),null!=dragtimer&&(clearTimeout(dragtimer),dragtimer=null),QV("bigok",!0),QV("bigfail",!1))}function ondragleave(e){xxdialogMode||(haltEvent(e),dragtimer=setTimeout(function(){QV("bigfail",!1),QV("bigok",!1),dragtimer=null},10))}function onkeypress(e){xxdialogMode||(" "==e.key&&(togglePause(),haltEvent(e)),"1"==e.key&&(Q("PlaySpeed").value=4,haltEvent(e)),"2"==e.key&&(Q("PlaySpeed").value=2,haltEvent(e)),"3"==e.key&&(Q("PlaySpeed").value=1,haltEvent(e)),"4"==e.key&&(Q("PlaySpeed").value=.5,haltEvent(e)),"5"==e.key&&(Q("PlaySpeed").value=.25,haltEvent(e)),"6"==e.key&&(Q("PlaySpeed").value=.1,haltEvent(e)),"0"==e.key&&(pause(),restart(),haltEvent(e)))}function saveAsWebMfile(){var e="";setDialogMode(2,"Converter para WebM",3,saveAsWebMfileEx,(e+=addHtmlValue4("Taxa de quadros","<select id=webmframerate style=width:200px><option value=100 selected>10 quadros / s</option><option value=50>20 quadros / s</option></select>"))+addHtmlValue4("Qualidade","<select id=webmquality style=width:200px><option value=90>90%</option><option value=80>80%</option><option value=60 selected>60%</option><option value=40>40%</option><option value=20>20%</option><option value=10>10%</option></select>"))}function saveAsWebMfileEx(){videoFrameDuration=parseInt(Q("webmframerate").value);var e=parseInt(Q("webmquality").value)/100;videoWriterLastFrame=null,videoWriter=new WebMWriter({quality:e,frameDuration:100,transparent:!1}),restart(),play(),QE("PlayButton",!1),QE("PauseButton",!1),QE("RestartButton",!1),QE("PlaySpeed",!1),QE("SeekBackwardButton",!1),QE("SeekForwardButton",!1),QE("ConvertAsWebM",!1),QE("OpenFileButton",!1)}function preCanvasDraw(){var e;videoWriter&&videoFrameDuration<=(e=videoWriterCurrentFrame-videoWriterLastFrame)&&(videoWriter.addFrame(Q("Desk"),e),videoWriterLastFrame=videoWriterCurrentFrame)}function openfile(){xxdialogMode||(setDialogMode(2,"Abrir arquivo...",3,openfileEx,'<input type=file name=files id=p2fileinput style=width:100% accept=".mcrec" onchange="openfileChanged()" />'),QE("idx_dlgOkButton",!1))}function openfileEx(){var e=Q("p2fileinput").files;if(null!=e){var t,a=[];for(t in e)null!=e[t].type&&null!=e[t].size&&0!=e[t].size&&e[t].name.endsWith(".mcrec")&&a.push(e[t])}0!=a.length&&(cleanup(),recFile=a[0],recFilePtr=0,readLastBlock(function(e,t,a,r){3==e?(recFileEndTime=a,recFileExtras=r,readNextBlock(processFirstBlock)):recFileEndTime=0}),Q("OpenFileButton").blur())}function openfileChanged(){var e=Q("p2fileinput").files;if(null!=e){var t,a=[];for(t in e)null!=e[t].type&&null!=e[t].size&&0!=e[t].size&&e[t].name.endsWith(".mcrec")&&a.push(e[t])}QE("idx_dlgOkButton",1==a.length)}function togglePause(){if(!xxdialogMode&&null==term)return null!=recFile&&(1==playing?pause():recFilePtr!=recFile.size&&play()),!1}function play(){xxdialogMode||(Q("PlayButton").blur(),1!=playing&&0!=recFileProtocol&&(playing=!0,QV("metadatadiv",!1),QE("PlayButton",!1),QE("PauseButton",!0),QE("RestartButton",!1),1==recFileProtocol&&null==term&&(QV("DeskParent",!1),QV("TermParent",!1),QV("XTermParent",!0),setupXTerm()),readNextBlock(processBlock)))}function pause(){xxdialogMode||(Q("PauseButton").blur(),0!=playing&&(playing=!1,QE("PlayButton",recFilePtr!=recFile.size),QE("PauseButton",!1),QE("RestartButton",0!=recFilePtr),null!=waitTimer)&&(clearTimeout(waitTimer),waitTimer=null,processBlockEx(waitTimerArgs[0],waitTimerArgs[1],waitTimerArgs[2],waitTimerArgs[3]),waitTimerArgs=null))}function restart(){xxdialogMode||(Q("RestartButton").blur(),1!=playing&&(currentDeltaTimeTotalSec=readState=recFilePtr=0,QV("metadatadiv",!0),QE("PlayButton",!0),QE("PauseButton",!1),QE("RestartButton",!1),QS("progressbar").width="0px",QH("timespan","00:00:00"),QV("DeskParent",!0),QV("TermParent",!1),QV("XTermParent",!1),clearXTerm(),agentDesktop?agentDesktop.Canvas.clearRect(0,0,agentDesktop.CanvasId.width,agentDesktop.CanvasId.height):amtDesktop?(amtDesktop.canvas.clearRect(0,0,amtDesktop.CanvasId.width,amtDesktop.CanvasId.height),(amtDesktop=CreateAmtRemoteDesktop("Desk")).onScreenSizeChange=deskAdjust,amtDesktop.State=3,amtDesktop.Start(),200==recFileMetadata.protocol&&(recFileMetadata.screenSize&&(amtDesktop.width=recFileMetadata.screenSize[0],amtDesktop.height=recFileMetadata.screenSize[1]),recFileMetadata.bpp&&(amtDesktop.bpp=recFileMetadata.bpp),recFileMetadata.graymode&&(amtDesktop.graymode=recFileMetadata.graymode),recFileMetadata.lowcolor&&(amtDesktop.lowcolor=recFileMetadata.lowcolor),amtDesktop.state=3)):agentTerminal=agentTerminal&&null))}function clearConsoleMsg(){QH("p11DeskConsoleMsg","")}function toggleAspectRatio(e){1===e&&(deskAspectRatio=(deskAspectRatio+1)%3),deskAdjust()}function deskAdjust(){var e=Q("DeskParent").clientHeight,t=Q("DeskParent").clientWidth,a=Q("Desk").height,r=Q("Desk").width;2==deskAspectRatio?(QS("Desk")["margin-top"]=null,QS("Desk").height="100%",QS("Desk").width="100%",QS("DeskParent").overflow="hidden"):1==deskAspectRatio?(QS("Desk")["margin-top"]="0px",QS("Desk").height=a+"px",QS("Desk").width=r+"px",QS("DeskParent").overflow="scroll"):(a/r<e/t?(t=a*t/r+"px",QS("Desk").height=t,QS("Desk").width="100%"):(t=r*e/a+"px",QS("Desk").height="100%",QS("Desk").width=t),QS("Desk")["margin-top"]=null,QS("DeskParent").overflow="hidden")}function seekBackward(){var e;xxdialogMode||((e=Math.round(currentDeltaTimeTotalSec/recFileMetadata.indexInterval))<2?(pause(),restart()):null!=recFileMetadata.indexes[e-2]&&seek(e-2))}function seekForward(){var e;xxdialogMode||(e=Math.round(currentDeltaTimeTotalSec/recFileMetadata.indexInterval),null!=recFileMetadata.indexes[e]&&seek(e))}function progressBarSeek(e){e=Math.round(e.clientX/document.body.offsetWidth*(recFileMetadata.indexes.length+1))-1;-1==e?(pause(),restart()):seek(e)}function seek(e){if(!xxdialogMode){if(null==recFileMetadata.indexes||null==recFileMetadata.indexes[e])return null;SeekPlayState=playing,pause(),restart(),SeekIndex=recFileMetadata.indexes[e],SeekIndexPtr=3,recFileLastTime=SeekIndexTime=recFileStartTime+(1+e)*recFileMetadata.indexInterval*1e3,recFilePtr=recFileIndexBasePtr+SeekIndex[0];var e=SeekIndex[1],t=SeekIndex[2];QS("progressbar").width=0==recFileEndTime?Math.floor(recFilePtr/recFile.size*100)+"%":Math.floor((recFileLastTime-recFileStartTime)/(recFileEndTime-recFileStartTime)*100)+"%",agentDesktop&&(agentDesktop.Canvas.clearRect(0,0,agentDesktop.CanvasId.width,agentDesktop.CanvasId.height),agentDesktop.ProcessScreenMsg(e,t)),QV("metadatadiv",!1),QV("Desk",!1),seekFetchNext(function(){QV("Desk",!0),SeekPlayState&&play()})}}function seekFetchNext(i){null==SeekIndex[SeekIndexPtr]?i():readBlockAt(recFileIndexBasePtr+SeekIndex[SeekIndexPtr],function(e,t,a,r){SeekIndexPtr++,processBlockEx(e,t,SeekIndexTime,r,!0),seekFetchNext(i)})}var xxdialogFunc,xxdialogButtons,xxdialogTag,xxdialogMode=0,xxcurrentView=-1;function setDialogMode(e,t,a,r,i,n){xxdialogMode=e,xxdialogFunc=r,xxdialogButtons=a,xxdialogTag=n,QE("idx_dlgOkButton",!0),QV("idx_dlgOkButton",1&a),QV("idx_dlgCancelButton",2&a),QV("id_dialogclose",2&a||8&a),QV("idx_dlgDeleteButton",4&a),QV("idx_dlgButtonBar",7&a),t&&QH("id_dialogtitle",t);for(var o=1;o<3;o++)QV("dialog"+o,o==e);QV("dialog",e),i&&(2==e?QH("id_dialogOptions",i):QH("id_dialogMessage",i))}function dialogclose(e){var t=xxdialogFunc,a=xxdialogButtons,r=xxdialogTag;setDialogMode(),(8&a||e)&&t&&t(e,r)}function messagebox(e,t){setSessionActivity(),QH("id_dialogMessage",t),setDialogMode(1,e,1)}function statusbox(e,t){setSessionActivity(),QH("id_dialogMessage",t),setDialogMode(1,e)}function haltEvent(e){return e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1}function pad2(e){e="00"+e;return e.substr(e.length-2)}function format(e){var a=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,t){return void 0!==a[t]?a[t]:e})}function addHtmlValue(e,t){return"<table><td style=width:120px>"+e+"<td><b>"+t+"</b></table>"}function addHtmlValue2(e,t){return"<div><div style=display:inline-block;float:right>"+t+"</div><div style=display:inline-block>"+e+"</div></div>"}function addHtmlValue3(e,t){return"<div><b>"+e+"</b></div><div style=margin-left:16px>"+t+"</div>"}function addHtmlValue4(e,t){return"<table style=width:100%><td style=width:120px>"+e+"<td style=text-align:right><b>"+t+"</b></table>"}function addHtmlValue5(e,t){return"<div style=padding:4px><div style=display:inline-block;float:right><b>"+t+"</b></div><div style=display:inline-block>"+e+"</div></div>"}function dialogBoxDrag(){var t=Q("dialog"),a=0,r=0,i=0,n=0;function o(e){(e=e||window.event).preventDefault(),a=i-e.clientX,r=n-e.clientY,i=e.clientX,n=e.clientY,t.style.top=t.offsetTop-r+"px",t.style.left=t.offsetLeft-a+"px"}function l(){document.onmouseup=null,document.onmousemove=null}Q("dialogHeader").onmousedown=function(e){(e=e||window.event).preventDefault(),i=e.clientX,n=e.clientY,document.onmouseup=l,document.onmousemove=o}}function ArrayBufferToString(e){try{return BinaryToString(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(e))))}catch(e){}console.log("ArrayBufferToString - Unable to convert "+e.byteLength+" bytes.");for(var t="",a=new Uint8Array(e),r=0;r<e.byteLength;r++)t+=String.fromCharCode(a[r]);return t}function StringToArrayBuffer(e){return StringToUint8Array(e).buffer}function BinaryToString(t){var a;try{return decodeURIComponent(escape(t))}catch(e){if((a=e)instanceof URIError)return t;throw a}}function StringToBinary(e){for(var t,a,r=e.length,i=[],n=!1,o=a=0;0<=r?a<r:r<a;o=0<=r?++a:--a){if(255<(t=String.prototype.charCodeAt.call(e,o))){n=!0,i=null;break}i.push(t)}return!0===n?unescape(encodeURIComponent(e)):String.fromCharCode.apply(null,Array.prototype.slice.apply(i))}function StringToUint8Array(e){for(var t,a=StringToBinary(e),r=a.length,e=new ArrayBuffer(r),i=new Uint8Array(e),n=t=0;0<=r?t<r:r<t;n=0<=r?++t:--t)i[n]=String.prototype.charCodeAt.call(a,n);return i}function setupXTerm(){null!=term&&term.dispose(),(term=new Terminal).open(Q("XTermParent")),term.onData(function(e){null!=tunnel&&tunnel.sendText(e)}),term.resize(80,25)}function clearXTerm(){null!=term&&(term.dispose(),term=null)}function writeXTerm(e){null!=term&&(term.writeUtf8?"string"==typeof e?term.writeUtf8(e):term.writeUtf8(new Uint8Array(e)):"string"==typeof e?term.write(e):term.write(new Uint8Array(e)))}start()</script>