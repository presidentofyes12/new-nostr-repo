<!doctypehtml><html lang=ca dir=ltr xmlns=http://www.w3.org/1999/xhtml><meta http-equiv=X-UA-Compatible content="IE=edge"><meta content="text/html;charset=utf-8"http-equiv=Content-Type><meta name=viewport content="user-scalable=1,initial-scale=1,minimum-scale=1,maximum-scale=1"><meta name=apple-mobile-web-app-capable content=yes><meta name=format-detection content="telephone=no"><meta name=robots content=noindex,nofollow><link type=text/css href=styles/style.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/style-sharing.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/xterm.css media=screen rel=stylesheet title=CSS><link rel=apple-touch-icon href=/favicon-303x303.png><script src=scripts/common-0.0.1{{min}}.js></script><script src=scripts/amt-redir-ws-0.1.0{{{min}}}.js></script><script src=scripts/amt-wsman-ws-0.2.0{{{min}}}.js></script><script src=scripts/agent-redir-ws-0.1.1{{{min}}}.js></script><script src=scripts/agent-redir-rtc-0.1.0{{{min}}}.js></script><script src=scripts/agent-desktop-0.0.2{{min}}.js></script><script src=scripts/amt-desktop-0.0.2{{min}}.js></script><script src=scripts/amt-terminal-0.0.2{{min}}.js></script><script src=scripts/zlib{{min}}.js></script><script src=scripts/zlib-inflate{{min}}.js></script><script src=scripts/zlib-adler32{{min}}.js></script><script src=scripts/zlib-crc32{{min}}.js></script><script src=scripts/amt-terminal-0.0.2{{min}}.js></script><script src=scripts/xterm{{{min}}}.js></script><script src=scripts/xterm-addon-fit{{{min}}}.js></script><script keeplink=1 src=scripts/filesaver.min.js></script><title>{{{title}}}</title><body style=overflow:hidden;background-color:#000><div id=LeftSideToolBar style="display:none;position:absolute;left:0;bottom:0;width:52px;top:0;background:#113962;background:linear-gradient(to bottom,#104893 0,#113962 100%);color:#fff;border-right:5px solid #bbb"><div id=LeftMenuDesktop class="slbbutton slbbuttonsel2"title=Escriptori onclick=go(11)><div class=slb1 style=position:absolute;top:6px;left:6px></div></div><div id=LeftMenuTerminal class=slbbutton title=Terminal onclick=go(12)><div class=slb2 style=position:absolute;top:6px;left:6px></div></div><div id=LeftMenuFiles class=slbbutton title=Fitxers onclick=go(13)><div class=slb3 style=position:absolute;top:6px;left:6px></div></div></div><div id=p11 class=noselect style=overflow:hidden;position:absolute;left:54px;top:0;right:0;bottom:0;display:none><div id=deskarea0><div id=deskarea1 class=areaHead style=line-height:24px><div class=toright2><span id=p11power></span>&nbsp;<div class=deskareaicon title="Canvia el mode de visualització"onclick=toggleAspectRatio(1)>⇲</div><div class=deskareaicon title="Gira a l'esquerra"onclick=drotate(-1)>↺</div><div class=deskareaicon title="Gira a la dreta"onclick=drotate(1)>↻</div><input id=deskActionsSettings type=button value=Configuració... title="Editeu la configuració de l'escriptori remot"onkeypress=return!1 onkeydown=return!1 onclick=showDesktopSettings() class=mR><div id=desktopCustomUiButtons style=float:left></div><div id=deskRecordIcon class=deskareaicon title="El servidor està gravant aquesta sessió"style=display:none;background-color:red;width:12px;height:12px;border-radius:6px;margin-top:5px></div></div><div><div id=idx_deskFullBtn2 onclick=deskToggleFull(event)>&nbsp;✖</div><input type=button id=autoconnectbutton1 value="Connexió automàtica"onclick=autoConnectDesktop(event) onkeypress=return!1 onkeydown=return!1 style=display:none> <span id=connectbutton1span><input type=button id=connectbutton1 cmenu=deskConnectButton value="Connecta't"onclick=connectDesktop(event,3) onkeypress=return!1 onkeydown=return!1 disabled></span><span id=connectbutton1hspan>&nbsp;<input type=button id=connectbutton1h value="HW Connect"title="Connecteu-vos amb el maquinari Intel AMT KVM"onclick=connectDesktop(event,2) onkeypress=return!1 onkeydown=return!1 disabled></span><span id=disconnectbutton1span>&nbsp;<input type=button id=disconnectbutton1 value=Desconnecta onclick=connectDesktop(event,0) onkeypress=return!1 onkeydown=return!1></span>&nbsp;<span id=deskstatus>Desconnectat</span><span id=deskmetadata></span></div></div><div id=deskarea3x style="max-height:calc(100vh - 52px);height:calc(100vh - 56px)"><div id=DeskFocus oncontextmenu=return!1 onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event)></div><div id=DeskParent><canvas id=Desk width=640 height=480 oncontextmenu=return!1 onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event) onmousewheel=dmousewheel(event)></canvas></div><div id=p11DeskConsoleMsg style=display:none;text-align:left;cursor:pointer;position:absolute;left:30px;top:17px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px onclick=clearConsoleMsg()></div></div><div id=deskarea4 class=areaFoot style=min-height:24px><div class=toright2><span id=DeskLatency style=line-height:22px;width:50px title="Latència de sessió d'escriptori"></span> <span id=DeskTimer style=line-height:22px title="Temps de sessió"></span>&nbsp; <select id=termdisplays style=display:none onchange=deskSetDisplay(event) onkeypress=return!1 onkeydown=return!1></select>&nbsp; <span id=DeskSaveImageButton title="Deseu una captura de pantalla de l'escriptori remot"><img src=images/icon-camera.png onclick=deskSaveImage() height=16 width=16 style=padding-top:2px></span></div><div style=height:22px><select id=deskkeys><option value=10>Ctrl+Alt+Supr<option value=5>Guanyar<option value=0>Win+Down<option value=1>Guanyar+Amunt<option value=2>Guanya+L<option value=3>Guanya+M<option value=4>Maj+Win+M<option value=6>Guanya+R<option value=7>Alt-F4<option value=8>Ctrl-W<option value=9>Alt-Tab<option value=11>Guanya+Esquerra<option value=12>Guanyar + Dret</select> <input id=DeskWD type=button value=Enviar onkeypress=return!1 onkeydown=return!1 onclick=deskSendKeys()> <input id=DeskClip type=button value=Porta-retalls onkeypress=return!1 onkeydown=return!1 onclick=showDeskClip()> <input id=DeskType type=button value=Tipus onkeypress=return!1 onkeydown=return!1 onclick=showDeskType()> <label><span id=DeskControlSpan title="Commuta l'entrada del ratolí i el teclat"><input id=DeskControl type=checkbox onkeypress=return!1 onkeydown=return!1 onclick=toggleKvmControl()>Entrada</span></label>&nbsp;</div></div></div></div><div id=p12 class=noselect style=overflow:hidden;position:absolute;left:54px;top:0;right:0;bottom:0;display:none;background-color:#000><div id=p12warning onclick=showFeaturesDlg()><div class=icon2></div><div class=warningbox>El port de redirecció Intel® AMT o la funció KVM està desactivada<span id=p12warninga>, feu clic aquí per activar-lo.</span></div></div><div id=p12warning2 onclick=showPowerActionDlg()><div class=icon2></div><div class=warningbox>L'ordinador remot no està encès, feu clic aquí per emetre una ordre d'engegada.</div></div><div class=areaHead style=position:absolute;top:0;left:0;right:0;height:24px><div class=toright2><div id=termRecordIcon class=deskareaicon title="El servidor està gravant aquesta sessió"style=display:none;background-color:red;width:12px;height:12px;border-radius:6px;margin-top:5px;margin-left:5px></div><div id=p12power style=margin-top:3px;margin-right:4px;float:right></div></div><div><span id=connectbutton2span><input type=button id=connectbutton2 cmenu=termConnectButton value="Connecta't"onclick=connectTerminal(event,1) onkeypress=return!1 onkeydown=return!1 disabled></span><span id=disconnectbutton2span>&nbsp;<input type=button id=disconnectbutton2 value=Desconnecta onclick=connectTerminal(event,0) onkeypress=return!1 onkeydown=return!1></span>&nbsp;<span id=termstatus>Desconnectat</span><span id=termtitle></span></div></div><div id=termarea3xdiv style=position:absolute;top:28px;bottom:28px;left:0;right:0></div><div class=areaFoot style=position:absolute;bottom:0;left:0;right:0;height:24px><div class=toright2><span id=TermLatency title="Latència de la sessió terminal"></span> <span id=TermTimer title="Temps de sessió"></span>&nbsp; <span id=terminalSettingsButtons style=display:none><input id=id_tcrbutton type=button onkeypress=return!1 onkeydown=return!1 class=bottombutton value=CR+LF title="Commuta el que enviarà la clau de retorn"onclick=termToggleCr()> <input id=id_tfxkeysbutton type=button onkeypress=return!1 onkeydown=return!1 class=bottombutton value="Intel (F10 = ESC+[OM)"title="Canvia el tipus d'emulació de tecles F1 a F10"onclick=termToggleFx()> <input id=id_ttypebutton type=button onkeypress=return!1 onkeydown=return!1 class=bottombutton value="Ascii estès"title="Canvia el tipus d'emulació de terminal"onclick=termToggleType()> </span><span id=terminalSizeDropDown style=display:none><select id=termSizeList onkeypress=return!1><option value=1>80x25<option value=2>100 x 30</select> </span><span id=specialKeyDropDown><select id=specialkeylist onkeypress=return!1></select> <input id=specialkeylistinput type=button onkeypress=return!1 class=bottombutton value=Enviar title="Envia la clau especial seleccionada"onclick=sendSpecialKey()></span></div><div>&nbsp; <input type=button onkeypress=return!1 onkeydown=return!1 class=bottombutton id=ctrlcbutton value=Ctl-C onclick='termSendKey(3,"ctrlcbutton")'> <input type=button onkeypress=return!1 onkeydown=return!1 class=bottombutton id=ctrlxbutton value=Ctl-X onclick='termSendKey(24,"ctrlxbutton")'> <input type=button onkeypress=return!1 onkeydown=return!1 class=bottombutton id=escbutton value=ESC onclick='termSendKey(27,"escbutton")'> <input type=button onkeypress=return!1 onkeydown=return!1 class=bottombutton id=bsbutton value=Retrocés onclick='termSendKey(8,"bsbutton")'style=display:none> <input type=button onkeypress=return!1 onkeydown=return!1 class=bottombutton id=pastebutton value=Enganxa title="Enganxeu text al terminal"onclick=showTermPasteDialog() style=display:none></div></div><div id=p12TermConsoleMsg style=display:none;text-align:left;cursor:pointer;position:absolute;left:30px;top:45px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px onclick=p12clearConsoleMsg()></div></div><div id=p13 class=noselect style=overflow:hidden;position:absolute;left:54px;top:0;right:0;bottom:0;display:none;background-color:#fff><div id=p13toolbar style=position:absolute;left:0;top:0;right:0;bottom:28px><div class=areaHead><div class=toright2><div id=filesRecordIcon class=deskareaicon title="El servidor està gravant aquesta sessió"style=display:none;background-color:red;width:12px;height:12px;border-radius:6px;margin-top:5px;margin-left:5px></div><div id=p13power style=margin-top:3px;margin-right:4px;float:right></div></div><div><input id=p13Connect value="Connecta't"onclick=connectFiles(event) type=button> &nbsp;<span id=p13Status>Desconnectat</span></div></div><div id=fileArea2 class=areaHead2 valign=bottom><div id=p13rightOfButtons class=toright2></div><div><input type=button id=p13FolderUp disabled onclick=p13folderup() value=Amunt>&nbsp; <input type=button id=p13SelectAllButton disabled onclick=p13selectallfile() value="Seleccionar tot">&nbsp; <input type=button id=p13RenameFileButton disabled value="Canvia el nom"onclick=p13renamefile()>&nbsp; <input type=button id=p13DeleteFileButton disabled value=Suprimeix onclick=p13deletefile()>&nbsp; <input type=button id=p13ViewFileButton disabled value=Edita onclick=p13viewfile()>&nbsp; <input type=button id=p13NewFolderButton disabled value="Carpeta nova"onclick=p13createfolder()>&nbsp; <input type=button id=p13UploadButton disabled value=Carrega onclick=p13uploadFile()>&nbsp; <input type=button id=p13CutButton disabled value=Tallar onclick=p13copyFile(1)>&nbsp; <input type=button id=p13CopyButton disabled value=Còpia onclick=p13copyFile(0)>&nbsp; <input type=button id=p13PasteButton disabled value=Enganxa onclick=p13pasteFile()>&nbsp; <input type=button id=p13ZipButton disabled value=Zip onclick=p13zipFiles()>&nbsp; <input type=button id=p13RefreshButton disabled value=Actualització onclick=p13folderup(9999)>&nbsp; <input type=button id=p13FindButton disabled value=Troba onclick=p13findfile()>&nbsp;</div></div><div class=areaHead3 style=line-height:28px><div class=toright2><select id=p13sortdropdown onchange=p13updateFiles()><option value=1 selected>Ordena per nom<option value=2>Ordena per mida<option value=3>Ordena per data<option value=4>Baixar pel nom<option value=5>Baixar per mida<option value=6>Descens per data</select></div><div>&nbsp;&nbsp;<span id=p13currentpath></span></div></div><div id=fileArea4 style="height:calc(100vh - 146px)"><div id=p13FilesConsoleMsg style=display:none;text-align:left;cursor:pointer;position:absolute;left:30px;top:165px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px onclick=p13clearConsoleMsg()></div><div id=p13filetable style=width:100%;height:100%><div id=p13bigok style=display:none><b>✓</b></div><div id=p13bigfail style=display:none><b>✗</b></div><span id=p13files></span></div></div></div><div class=areaFoot style=position:absolute;left:0;right:0;bottom:0;height:28px>&nbsp;<span id=p13bottomstatus></span></div></div><div id=dialog class=noselect style=display:none><div id=dialogHeader><div tabindex=0 id=id_dialogclose onclick=setDialogMode() onkeypress='"Enter"==event.key&&setDialogMode()'>✖</div><div id=id_dialogtitle></div></div><div id=dialogBody><div id=dialog1><div id=id_dialogMessage></div></div><div id=dialog2><div id=id_dialogOptions></div></div><div id=dialog7><div id=d7meshkvm><h4>Agent d'escriptori remot</h4><div><div>Qualitat</div><select id=d7bitmapquality dir=rtl></select></div><div><div>Escalat</div><select id=d7bitmapscaling dir=rtl><option selected value=1024>100%<option value=896>87,5%<option value=768>75%<option value=640>62,5%<option value=512>50%<option value=384>37,5%<option value=256>25%<option value=128>12,5%</select></div><div><div>Velocitat de fotogrames</div><select id=d7framelimiter dir=rtl><option selected value=50>Ràpid<option value=100>Mitjana<option value=400>Lent<option value=1000>Molt lent</select></div><div id=d7desktopOtherSettings><div>Altres configuracions</div><div id=d7otherset2 style=display:block><label style=display:block><input type=checkbox id=d7deskSwapMouse>Canvia els botons del ratolí</label> <label style=display:block><input type=checkbox id=d7deskRemoteKeyMap>Utilitzeu el mapa de teclat remot</label></div></div></div><div id=d7amtkvm><h4>KVM de maquinari Intel® AMT</h4><div><div>Codificació d'imatges</div><select id=d7desktopmode><option value=1>RLE8, el més ràpid<option value=2>RLE16, recomanat<option value=3>RAW8, Lent<option value=4>RAW16, molt lent</select></div><div><div>Altres configuracions</div><div id=d7otherset style=display:block><label style=display:block><input type=checkbox id=d7showfocus>Mostra l'eina de focus</label> <label style=display:block><input type=checkbox id=d7showcursor>Mostra el cursor del ratolí local</label> <label style=display:block><input type=checkbox id=d7localKeyMap>Mapa local del teclat</label></div></div></div></div></div><div id=idx_dlgButtonBar><input id=idx_dlgCancelButton type=button value="Cancel · lar"onclick=dialogclose(0)> <input id=idx_dlgOkButton type=button value="D'acord"onclick=dialogclose(1)><div><input id=idx_dlgDeleteButton type=button value=Suprimeix style=display:none onclick=dialogclose(2)></div></div></div><script>var random="{{{randomlength}}}",sessionActivity=null,desktop=null,agentPresent=!0,intelAmtPresent=!1,deskAspectRatio=0,desktopsettings={encoding:2,showfocus:!1,showmouse:!0,showcad:!0,quality:40,scaling:1024,framerate:100,localkeymap:!1,remotekeymap:!1},serverPublicNamePort="{{{serverDnsName}}}:{{{serverPublicPort}}}",domain="{{{domain}}}",domainUrl="{{{domainurl}}}",authCookie="{{{authCookie}}}",viewOnly=parseInt("{{{viewOnly}}}"),urlargs=parseUriArgs(),debugmode=urlargs.debug,attemptWebRTC=!1,updateSessionTimer=null,StatusStrs=["Desconnectat","Connectant...","Configuració...","Connectat","Intel&reg; AMT connectat"],nodeName=decodeURIComponent("{{{nodeName}}}"),webPageFullScreen=!1,expire="{{{expire}}}",features=(""!=expire&&(QH("p11power",printFlexDateTime(new Date(parseInt(expire)))),QH("p12power",printFlexDateTime(new Date(parseInt(expire)))),QH("p13power",printFlexDateTime(new Date(parseInt(expire))))),parseInt("{{{features}}}")),features2=parseInt("{{{features2}}}"),t=null;try{t=localStorage.getItem("desktopsettings")}catch(e){}if(null!=t)try{desktopsettings=JSON.parse(t)}catch(e){}0==(1&features2)&&60<desktopsettings.quality&&(desktopsettings.quality=60);var terminal=null,xterm=null,xtermfit=null,xtermResizeTimer=null,files=null,p11DeskConsoleMsgTimer=null,p12TermConsoleMsgTimer=null,p13FilesConsoleMsgTimer=null;function start(){window.onresize=deskAdjust,document.onkeypress=ondockeypress,document.onkeydown=ondockeydown,document.onkeyup=ondockeyup,setupDesktop(),setupTerminal(),setupFiles(),0<nodeName.length&&(document.title+=" - "+nodeName),1==viewOnly&&(QV("deskkeys",!1),QV("DeskWD",!1),QV("DeskClip",!1),QV("DeskType",!1),QV("DeskControlSpan",!1)),Q("p13filetable").addEventListener("drop",p13fileDragDrop,!1),Q("p13filetable").addEventListener("dragover",p13fileDragOver,!1),Q("p13filetable").addEventListener("dragleave",p13fileDragLeave,!1),QV("LeftMenuDesktop",2&features),QV("LeftMenuTerminal",1&features),QV("LeftMenuFiles",4&features),2&features?go(11):1&features?go(12):4&features&&go(13);var e=0;1&features&&e++,2&features&&e++,4&features&&e++,QV("LeftSideToolBar",1<e),QS("p11").left=1<e?"54px":"0px",QS("p12").left=1<e?"54px":"0px",QS("p13").left=1<e?"54px":"0px",deskAdjust()}function isInputAllowed(){return 1!=viewOnly&&1==Q("DeskControl").checked}function clearConsoleMsg(){QH("p11DeskConsoleMsg","")}function toggleAspectRatio(e){1===e&&(deskAspectRatio=(deskAspectRatio+1)%3),deskAdjust()}function deskAdjust(){12==xxcurrentView&&null!=terminal&&null!=xtermfit&&xtermfit.fit(),QS("fileArea4").height="calc(100vh - "+(90+Q("fileArea2").clientHeight)+"px)";var e=Q("DeskParent").clientHeight,t=Q("DeskParent").clientWidth,o=Q("Desk").height,n=Q("Desk").width;2==deskAspectRatio?(QS("Desk")["margin-top"]=null,QS("Desk").height="100%",QS("Desk").width="100%",QS("DeskParent").overflow="hidden"):1==deskAspectRatio?(QS("Desk")["margin-top"]="0px",QS("Desk").height=o+"px",QS("Desk").width=n+"px",QS("DeskParent").overflow="scroll"):(o/n<e/t?(t=o*t/n+"px",QS("Desk").height=t,QS("Desk").width="100%"):(t=n*e/o+"px",QS("Desk").height="100%",QS("Desk").width=t),QS("Desk")["margin-top"]=null,QS("DeskParent").overflow="hidden")}function setupDesktop(){null!=desktop&&(desktop.Stop(),desktop=null),null==desktop&&(QH("DeskParent",'<canvas id=Desk oncontextmenu="return false" onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event)></canvas>'),Q("Desk").addEventListener("DOMMouseScroll",function(e){return dmousewheel(e)}),Q("Desk").addEventListener("mousewheel",function(e){return dmousewheel(e)})),updateDesktopButtons(),deskAdjust(),updateMetadata(desktop,"deskmetadata")}function updateDesktopButtons(){var e=0;null!=desktop&&(e=desktop.State),QV("disconnectbutton1span",0!=e),QV("connectbutton1span",0==e&&agentPresent),QV("connectbutton1hspan",0==e&&intelAmtPresent),QV("d7meshkvm",agentPresent&&(0==e||1==desktop.contype)),QV("d7amtkvm",intelAmtPresent&&(0==e||2==desktop.contype)),QE("connectbutton1",agentPresent),QE("connectbutton1h",intelAmtPresent),QV("DeskClip",!1),QE("DeskClip",3==e),QE("DeskType",3==e),QV("DeskWD",1!=viewOnly),QE("DeskWD",3==e),QV("deskkeys",1!=viewOnly),QE("deskkeys",3==e),QV("DeskTimer",3==e),QV("DeskLatency",3==e),QS("DeskLatency").display=3==e?"inline-block":"none",QV("DeskSaveImageButton",3==e&&null!=Q("Desk").toBlob),QV("DeskControlSpan",1!=viewOnly),QV("deskActionsBtn",0==browserfullscreen),QV("deskActionsSettings",0==browserfullscreen),Q("DeskControl").checked=!0,QS("DeskControlSpan").color=Q("DeskControl").checked?null:"red"}var autoConnectDesktopTimer=null;function autoConnectDesktop(e){autoConnectDesktopTimer=null==autoConnectDesktopTimer?setInterval(function(){connectDesktop(null,1)},1e3):(clearInterval(autoConnectDesktopTimer),null)}var agentConsoleMessages=["","S'està esperant que l'usuari concedeixi l'accés...","Negat","No s'ha pogut iniciar la sessió del terminal remot, {0} ({1})","Temps mort","S'han rebut dades de xarxa no vàlides"];function formatAgentConsoleMessage(e,t,o){for(null==o&&(o=[]);o.length<3;)o.push("");return(t&&t<agentConsoleMessages.length?EscapeHtml(format(agentConsoleMessages[t],o[0],o[1],o[2])):EscapeHtml(e)).split("\n").join("<br />")+"<br /><br />"}function connectDesktop(e,t,o,n){xxdialogMode||(null!=e&&0!=e.shiftKey&&3==t&&(t=1),QV("p11DeskSessionSelector",!1),p11clearConsoleMsg(),null==desktop?2==t?((desktop=CreateAmtRedirect(CreateAmtRemoteDesktop("Desk"),authCookie)).debugmode=debugmode,desktop.onStateChanged=onDesktopStateChange,desktop.m.stopInput=1==viewOnly,desktop.m.bpp=1==desktopsettings.encoding||3==desktopsettings.encoding?1:2,desktop.m.useZRLE=desktopsettings.encoding<3,desktop.m.localKeyMap=desktopsettings.localkeymap,desktop.m.showmouse=desktopsettings.showmouse,desktop.m.onScreenSizeChange=deskAdjust,desktop.m.onKvmData=function(e){if(0==e.length)desktop.m._sentPresence||(desktop.m._sentPresence=!0,desktop.m.sendKvmData(JSON.stringify({action:"present",ver:1})));else{var t=null;try{t=JSON.parse(e)}catch(e){}null!=t&&null!=t.action&&("restart"==t.action?(webRtcDesktopReset(),desktop.m.sendKvmData(JSON.stringify({action:"present",ver:1}))):"present"==t.action&&null==webRtcDesktop?(webRtcDesktop={platform:t.platform},"undefined"!=typeof RTCPeerConnection?webRtcDesktop.webrtc=new RTCPeerConnection(null):"undefined"!=typeof webkitRTCPeerConnection&&(webRtcDesktop.webrtc=new webkitRTCPeerConnection(null)),webRtcDesktop.webchannel=webRtcDesktop.webrtc.createDataChannel("DataChannel",{}),webRtcDesktop.webchannel.onopen=function(){console.log("WebRTC Data Channel Open"),Q("deskstatus").textContent=StatusStrs[desktop.State]+", Soft-KVM",desktop.m.hold(!0),webRtcDesktop.webRtcActive=!0,webRtcDesktop.softdesktop=CreateKvmDataChannel(webRtcDesktop.webchannel,CreateAgentRemoteDesktop("Desk",Q("id_mainarea")),desktop.m),webRtcDesktop.softdesktop.m.setRotation(desktop.m.rotation),webRtcDesktop.softdesktop.m.onScreenSizeChange=deskAdjust,desktopsettings.quality&&(webRtcDesktop.softdesktop.m.CompressionLevel=desktopsettings.quality),desktopsettings.scaling&&(webRtcDesktop.softdesktop.m.ScalingLevel=desktopsettings.scaling),webRtcDesktop.softdesktop.Start()},webRtcDesktop.webchannel.onclose=function(e){console.log("WebRTC Data Channel Closed"),webRtcDesktopReset()},webRtcDesktop.webrtc.onicecandidate=function(e){null==e.candidate?desktop.m.sendKvmData(JSON.stringify({action:"offer",ver:1,sdp:webRtcDesktop.webrtcoffer.sdp})):webRtcDesktop.webrtcoffer.sdp+="a="+e.candidate.candidate+"\r\n"},webRtcDesktop.webrtc.oniceconnectionstatechange=function(){null==webRtcDesktop||null==webRtcDesktop.webrtc||"disconnected"!=webRtcDesktop.webrtc.iceConnectionState&&"failed"!=webRtcDesktop.webrtc.iceConnectionState||webRtcDesktopReset()},webRtcDesktop.webrtc.createOffer(function(e){webRtcDesktop.webrtcoffer=e,webRtcDesktop.webrtc.setLocalDescription(e,function(){},webRtcDesktopReset)},webRtcDesktopReset,{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}})):"answer"==t.action&&null!=webRtcDesktop&&webRtcDesktop.webrtc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:t.sdp}),function(){},webRtcDesktopReset))}},desktop.Start(null,16994,"*","*",0),desktop.contype=2):null!=t&&1!=t&&3!=t||((desktop=CreateAgentRedirect(null,CreateAgentRemoteDesktop("Desk"),serverPublicNamePort,authCookie,null,domainUrl)).m.stopInput=1==viewOnly,desktop.m.mouseCursorActive(!0),desktop.debugmode=debugmode,desktop.m.debugmode=debugmode,desktop.attemptWebRTC=attemptWebRTC,desktop.options={},null!=o&&(desktop.options.tsid=o),null!=n&&(desktop.options.consent=n),desktop.onStateChanged=onDesktopStateChange,desktop.onConsoleMessageChange=function(){desktop.consoleMessage?(Q("p11DeskConsoleMsg").innerHTML+=formatAgentConsoleMessage(desktop.consoleMessage,desktop.consoleMessageId,desktop.consoleMessageArgs),QV("p11DeskConsoleMsg",!0),null!=p11DeskConsoleMsgTimer&&clearTimeout(p11DeskConsoleMsgTimer),desktop.consoleMessageTimeout&&(p11DeskConsoleMsgTimer=setTimeout(p11clearConsoleMsg,1e3*desktop.consoleMessageTimeout))):p11clearConsoleMsg()},desktop.onMetadataChange=function(e){updateMetadata(desktop,"deskmetadata")},desktop.m.CompressionLevel=desktopsettings.quality,desktop.m.ScalingLevel=desktopsettings.scaling,desktopsettings.framerate&&(desktop.m.FrameRateTimer=desktopsettings.framerate),desktop.m.onDisplayinfo=deskDisplayInfo,desktop.m.onScreenSizeChange=deskAdjust,desktop.Start(null),desktop.latency.callback=function(e){updateSessionTime()},desktop.contype=1):(desktop.Stop(),webRtcDesktopReset(),desktop=null))}function updateMetadata(e,t){var o="",n=0;if(e&&3==e.State){if(e.metadata&&e.metadata.users)for(var l in e.metadata.users)n+=e.metadata.users[l];1<n&&(o="<span onclick=showSessionMetadata(1) style=cursor:pointer>"+format(", {0} mirant",n)+"</span>")}QH("deskmetadata",o),e==desktop&&"sessionMetadata1"==xxdialogTag&&showSessionMetadata(1)}function showSessionMetadata(e){if(!xxdialogMode||xxdialogTag=="sessionMetadata"+e){xxdialogMode&&setDialogMode(0);var t=1==e?desktop:null;if(t&&t.metadata){var o="";if(t.metadata.startTime&&(o+=addHtmlValue4("L'hora d'inici",printDateTime(new Date(t.metadata.startTime)))),t.metadata.users)for(var n in t.metadata.users){var l=1==t.metadata.users[n]?"1 connexió":format("{0} connexions",t.metadata.users[n]),s=n.split("/")[2];null!=users&&null!=users[n]&&(s=users[n].name),o+=addHtmlValue4(format('Usuari "{0}"',s),l)}setDialogMode(2,"Informació de la sessió",1,null,o,"sessionMetadata"+e)}}}function p11clearConsoleMsg(){QH("p11DeskConsoleMsg",""),QV("p11DeskConsoleMsg",!1),p11DeskConsoleMsgTimer&&(clearTimeout(p11DeskConsoleMsgTimer),p11DeskConsoleMsgTimer=null)}function p12clearConsoleMsg(){QH("p12TermConsoleMsg",""),QV("p12TermConsoleMsg",!1),p12TermConsoleMsgTimer&&(clearTimeout(p12TermConsoleMsgTimer),p12TermConsoleMsgTimer=null)}function p13clearConsoleMsg(){QH("p13FilesConsoleMsg",""),QV("p13FilesConsoleMsg",!1),p13FilesConsoleMsgTimer&&(clearTimeout(p13FilesConsoleMsgTimer),p13FilesConsoleMsgTimer=null)}var webRtcDesktop=null;function webRtcDesktopReset(){if(null!=webRtcDesktop){if(null!=webRtcDesktop.softdesktop&&(webRtcDesktop.softdesktop.Stop(),webRtcDesktop.softdesktop=null),null!=webRtcDesktop.webchannel){try{webRtcDesktop.webchannel.close()}catch(e){}webRtcDesktop.webchannel=null}if(null!=webRtcDesktop.webrtc){try{webRtcDesktop.webrtc.close()}catch(e){}webRtcDesktop.webrtc=null}webRtcDesktop=null,desktop&&desktop.m&&(desktop.m.hold(!1),Q("deskstatus").textContent=StatusStrs[desktop.State])}}function onDesktopStateChange(e,t){var o=t,e=(3==o&&2==e.contype&&o++,StatusStrs[o]);switch(null!=desktop&&1==desktop.webRtcActive&&(e+=", WebRTC"),QH("deskstatus",e),t){case 0:null!=desktop.m.recordedData&&deskRecordSession(),desktop.Stop(),desktop=null,QV("DeskFocus",!1),QV("termdisplays",!1),QV("deskRecordIcon",!1),1==fullscreen&&deskToggleFull(),webRtcDesktopReset(),deskPreferedStickyDisplay=0;break;case 2:break;case 3:desktop&&1==desktop.serverIsRecording&&QV("deskRecordIcon",!0),desktop.startTime=new Date,null==updateSessionTimer&&(updateSessionTimer=setInterval(updateSessionTime,1e3))}updateDesktopButtons(),deskAdjust(),setTimeout(deskAdjust,50),updateMetadata(desktop,"deskmetadata")}function updateSessionTime(){var e="",t=0;desktop&&desktop.startTime?(desktop.latency&&0<=desktop.latency.current&&(e=format("{0} ms",desktop.latency.current)),t=Math.floor((new Date-desktop.startTime)/1e3),QH("DeskTimer",zeroPad(Math.floor(t/3600),2)+":"+zeroPad(Math.floor(t/60)%60,2)+":"+zeroPad(t%60,2)),QH("DeskLatency",e)):(QH("DeskTimer",""),QH("DeskLatency","")),t=0,terminal&&terminal.startTime?(terminal.latency&&0<=terminal.latency.current&&(e=format("{0} ms, ",terminal.latency.current)),t=Math.floor((new Date-terminal.startTime)/1e3),QH("TermTimer",e+zeroPad(Math.floor(t/3600),2)+":"+zeroPad(Math.floor(t/60)%60,2)+":"+zeroPad(t%60,2))):QH("TermTimer",""),null==desktop&&null==terminal&&(clearInterval(updateSessionTimer),updateSessionTimer=null)}function showDesktopSettings(){xxdialogMode||(applyDesktopSettings(),updateDesktopButtons(),setDialogMode(7,"Configuració de l'escriptori remot",3,showDesktopSettingsChanged))}function showDesktopSettingsChanged(){desktopsettings.encoding=d7desktopmode.value,desktopsettings.showfocus=d7showfocus.checked,desktopsettings.showmouse=d7showcursor.checked,desktopsettings.quality=d7bitmapquality.value,desktopsettings.scaling=d7bitmapscaling.value,desktopsettings.framerate=d7framelimiter.value,desktopsettings.swapmouse=d7deskSwapMouse.checked,desktopsettings.remotekeymap=d7deskRemoteKeyMap.checked,desktopsettings.localkeymap=d7localKeyMap.checked,localStorage.setItem("desktopsettings",JSON.stringify(desktopsettings)),applyDesktopSettings(),desktop&&(1==desktop.contype&&(desktop.m.SwapMouse=desktopsettings.swapmouse,desktop.m.remoteKeyMap=desktopsettings.remotekeymap,0!=desktop.State)&&desktop.m.SendCompressionLevel(1,desktopsettings.quality,desktopsettings.scaling,desktopsettings.framerate),2==desktop.contype)&&0!=desktop.State&&(desktop.Stop(),setTimeout(function(){connectDesktop(null,2)},50))}function applyDesktopSettings(){var e,t="",o=1&features2?[100,90,80,70,60,50,40,30,20,10,5,1]:[60,50,40,30,20,10,5,1];for(e in o)t+="<option value="+o[e]+">"+o[e]+"%</option>";QH("d7bitmapquality",t),d7desktopmode.value=desktopsettings.encoding,d7showfocus.checked=desktopsettings.showfocus,d7showcursor.checked=desktopsettings.showmouse,d7bitmapquality.value=40,0<=o.indexOf(parseInt(desktopsettings.quality))&&(d7bitmapquality.value=desktopsettings.quality),d7bitmapscaling.value=desktopsettings.scaling,desktopsettings.framerate?d7framelimiter.value=desktopsettings.framerate:d7framelimiter.value=100,null!=desktopsettings.swapmouse&&(d7deskSwapMouse.checked=desktopsettings.swapmouse),null!=desktopsettings.remotekeymap&&(d7deskRemoteKeyMap.checked=desktopsettings.remotekeymap),desktopsettings.localkeymap&&(d7localKeyMap.checked=desktopsettings.localkeymap)}function enterBrowserFullscreen(e){e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}function exitBrowserFullscreen(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}function isBrowserFullscreen(){return!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)}var fullscreen=!1,browserfullscreen=!1;function deskToggleFull(e){var t=!(0===urlargs.xterm||null!=terminal&&null==xterm);(fullscreen=!fullscreen)?(QC("body").add("fulldesk"),QS("deskarea3x").height="100%",QS("deskarea3x")["max-height"]="100%",t?(QS("termTable").position="absolute",QS("termTable").top=QS("termTable").bottom=QS("termTable").left=QS("termTable").right="0"):(QS("termTable").height="100%",QS("termTable")["max-height"]="100%"),1==e.shiftKey&&(enterBrowserFullscreen(Q("container")),browserfullscreen=!0)):(QC("body").remove("fulldesk"),e=urlargs.hide,0==footerBar&&(e|=4),e=(1&e?0:66)+(2&e?0:24)+(4&e?0:45)+(8&e?0:60),QS("deskarea3x").height="calc(100vh - "+(75+e)+"px)",QS("deskarea3x")["max-height"]="calc(100vh - "+(75+e)+"px)",t?(QS("termTable").position=null,QS("termTable").top=QS("termTable").bottom=QS("termTable").left=QS("termTable").right=null):(QS("termTable").height="calc(100vh - "+(75+e)+"px)",QS("termTable")["max-height"]="calc(100vh - "+(75+e)+"px)"),1==browserfullscreen&&(exitBrowserFullscreen(),browserfullscreen=!1)),deskAdjust(),updateDesktopButtons(),adjustPanels(),null!=xterm&&12==xxcurrentView&&(xtermfit.fit(),xterm.focus())}function mdeskAdjust(e,t,o,n){var l,s,i,a;e&&t&&o&&n&&("Desk"==n.id?deskAdjust():(a=(l=[{x:180,y:101},{x:302,y:169},{x:454,y:255}][Q("sizeselect").selectedIndex]).x+2,i=Q("xdevices").clientWidth-30,s=Math.floor(i/a),s=a+Math.floor((i-s*a)/s),l.y=l.y*(s/l.x),l.x=s,i=l.y,a=l.x,0!=e.State&&(i=l.y,a=t/o*l.y),QS(n.id)["max-height"]=i+"px",QS(n.id)["max-width"]=a+"px",QS(n.id)["margin-top"]="0",QS(n.id)["margin-bottom"]="0"))}function deskSendKeys(){var e;Q("DeskWD").blur(),xxdialogMode||null==desktop||3!=desktop.State||(0==(e=Q("deskkeys").value)?2==desktop.contype?desktop.m.sendkey([[65511,1],[65364,1],[65364,0],[65511,0]]):desktop.m.SendKeyMsgKC([[desktop.m.KeyAction.EXDOWN,91],[desktop.m.KeyAction.DOWN,40],[desktop.m.KeyAction.UP,40],[desktop.m.KeyAction.EXUP,91]]):1==e?2==desktop.contype?desktop.m.sendkey([[65511,1],[65362,1],[65362,0],[65511,0]]):desktop.m.SendKeyMsgKC([[desktop.m.KeyAction.EXDOWN,91],[desktop.m.KeyAction.DOWN,38],[desktop.m.KeyAction.UP,38],[desktop.m.KeyAction.EXUP,91]]):2==e?2==desktop.contype?desktop.m.sendkey([[65511,1],[108,1],[108,0],[65511,0]]):desktop.sendCtrlMsg('{"action":"lock"}'):3==e?2==desktop.contype?desktop.m.sendkey([[65511,1],[109,1],[109,0],[65511,0]]):desktop.m.SendKeyMsgKC([[desktop.m.KeyAction.EXDOWN,91],[desktop.m.KeyAction.DOWN,77],[desktop.m.KeyAction.UP,77],[desktop.m.KeyAction.EXUP,91]]):4==e?2==desktop.contype?desktop.m.sendkey([[65505,1],[65511,1],[109,1],[109,0],[65511,0],[65505,0]]):desktop.m.SendKeyMsgKC([[desktop.m.KeyAction.DOWN,16],[desktop.m.KeyAction.EXDOWN,91],[desktop.m.KeyAction.DOWN,77],[desktop.m.KeyAction.UP,77],[desktop.m.KeyAction.EXUP,91],[desktop.m.KeyAction.UP,16]]):5==e?2==desktop.contype?desktop.m.sendkey([[65511,1],[65511,0]]):desktop.m.SendKeyMsgKC([[desktop.m.KeyAction.EXDOWN,91],[desktop.m.KeyAction.EXUP,91]]):6==e?2==desktop.contype?desktop.m.sendkey([[65511,1],[114,1],[114,0],[65511,0]]):desktop.m.SendKeyMsgKC([[desktop.m.KeyAction.EXDOWN,91],[desktop.m.KeyAction.DOWN,82],[desktop.m.KeyAction.UP,82],[desktop.m.KeyAction.EXUP,91]]):7==e?2==desktop.contype?desktop.m.sendkey([[65513,1],[65473,1],[65473,0],[65513,0]]):desktop.m.SendKeyMsgKC([[desktop.m.KeyAction.EXDOWN,18],[desktop.m.KeyAction.DOWN,115],[desktop.m.KeyAction.UP,115],[desktop.m.KeyAction.EXUP,18]]):8==e?2==desktop.contype?desktop.m.sendkey([[65507,1],[119,1],[119,0],[65507,0]]):desktop.m.SendKeyMsgKC([[desktop.m.KeyAction.EXDOWN,17],[desktop.m.KeyAction.DOWN,87],[desktop.m.KeyAction.UP,87],[desktop.m.KeyAction.EXUP,17]]):9==e?2==desktop.contype?desktop.m.sendkey([[65513,1],[65289,1],[65289,0],[65513,0]]):desktop.m.SendKeyMsgKC([[desktop.m.KeyAction.EXDOWN,18],[desktop.m.KeyAction.DOWN,9],[desktop.m.KeyAction.UP,9],[desktop.m.KeyAction.EXUP,18]]):10==e?desktop.m.sendcad():11==e?2==desktop.contype?desktop.m.sendkey([[65511,1],[65361,1],[65361,0],[65511,0]]):desktop.m.SendKeyMsgKC([[desktop.m.KeyAction.EXDOWN,91],[desktop.m.KeyAction.DOWN,37],[desktop.m.KeyAction.UP,37],[desktop.m.KeyAction.EXUP,91]]):12==e&&(2==desktop.contype?desktop.m.sendkey([[65511,1],[65363,1],[65363,0],[65511,0]]):desktop.m.SendKeyMsgKC([[desktop.m.KeyAction.EXDOWN,91],[desktop.m.KeyAction.DOWN,39],[desktop.m.KeyAction.UP,39],[desktop.m.KeyAction.EXUP,91]])))}function ondockeypress(e){if(setSessionActivity(),!xxdialogMode&&desktop&&isInputAllowed())return desktop.m.handleKeys(e)}function ondockeydown(e){if(setSessionActivity(),!xxdialogMode&&desktop&&isInputAllowed())return desktop.m.handleKeyDown(e)}function ondockeyup(e){if(setSessionActivity(),!xxdialogMode&&desktop&&isInputAllowed())return desktop.m.handleKeyUp(e)}function showDeskType(){xxdialogMode||null==desktop||3!=desktop.State||(Q("DeskType").blur(),setDialogMode(2,"Entrada de teclat remota",3,showDeskTypeEx,"<div>Introduïu text i feu clic a D'acord per escriure'l de manera remota amb un teclat anglès dels EUA. Assegureu-vos de col·locar el cursor remot a la posició correcta abans de continuar.<div><textarea id=d2typeText style=\"margin-top:5px;width:100%;height:184px;resize:none\" maxlength=2000></textarea>"),Q("d2typeText").focus())}var AmtDeskTypeTimer=null,AmtDeskTypeContent=null,DeskTypeTranslate={39:222,42:106,43:107,44:188,45:189,46:190,47:191,59:186,61:187,91:219,92:220,93:221,96:192,191:111},DeskTypeShiftTranslate={33:49,34:222,35:51,36:52,37:53,38:55,40:57,41:48,58:186,60:188,62:190,63:191,64:50,94:54,95:189,106:56,107:187,123:219,124:220,125:221,126:192};function showDeskTypeEx(){var e=Q("d2typeText").value,t=Q("d2typeText").value.toUpperCase(),o=[],n=!1;if(2==desktop.contype){for(var l in e){var s=e.charCodeAt(l);o.push([s,1],[s,0])}AmtDeskTypeContent=o,AmtDeskTypeTimer=setInterval(function(){var e=AmtDeskTypeContent.shift();desktop&&desktop.m.sendkey(e[0],e[1]),null!=desktop&&0!=AmtDeskTypeContent.length||(clearInterval(AmtDeskTypeTimer),AmtDeskTypeContent=null)},10)}else if(!0!==desktopsettings.remotekeymap)desktop.m.SendStringUnicode(e);else{for(var l in e){var s=e.charCodeAt(l),i=t.charCodeAt(l);65<=s&&s<=90||97<=s&&s<=122?(s==i&&0==n&&(o.push([desktop.m.KeyAction.DOWN,16]),n=!0),s!=i&&1==n&&(o.push([desktop.m.KeyAction.UP,16]),n=!1)):48<=s&&s<=57?1==n&&(o.push([desktop.m.KeyAction.UP,16]),n=!1):DeskTypeTranslate[s]?(1==n&&(o.push([desktop.m.KeyAction.UP,16]),n=!1),i=DeskTypeTranslate[s]):DeskTypeShiftTranslate[s]&&(0==n&&(o.push([desktop.m.KeyAction.DOWN,16]),n=!0),i=DeskTypeShiftTranslate[s]),o.push([desktop.m.KeyAction.DOWN,i],[desktop.m.KeyAction.UP,i])}1==n&&(o.push([desktop.m.KeyAction.UP,16]),n=!1),desktop.m.SendKeyMsgKC(o)}}function sendCAD(){xxdialogMode||null==desktop||3!=desktop.State||desktop.m.sendcad()}function toggleKvmControl(){QS("DeskControlSpan").color=Q("DeskControl").checked?null:"red"}function deskSaveImage(){var e,t;xxdialogMode||null==desktop||3!=desktop.State||(e=new Date,t="Escriptori-"+e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+"-"+("0"+e.getHours()).slice(-2)+"-"+("0"+e.getMinutes()).slice(-2),Q("Desk").toBlob(function(e){saveAs(e,t+".png")}))}function deskDisplayInfo(e,t,o){var n,l=0,s="";for(n in t)l++,s+="<option"+(o==n?" selected":"")+" value="+n+">"+t[n]+"</option>",deskPreferedStickyDisplay==n&&o!=deskPreferedStickyDisplay&&desktop.m.SetDisplay(n),deskPreferedStickyDisplay=-1;QH("termdisplays",s),QV("termdisplays",1<l)}function deskGetDisplayNumbers(e){desktop.m.GetDisplayNumbers()}var deskPreferedStickyDisplay=-1;function deskSetDisplay(e){desktop.m.SetDisplay(deskPreferedStickyDisplay=parseInt(Q("termdisplays").value)),Q("termdisplays").blur()}var dblClickDetectArgs={t:0,x:0,y:0};function dblClickDetect(e){var t;1==e.buttons&&((t=Date.now())-dblClickDetectArgs.t<250&&Math.abs(e.clientX-dblClickDetectArgs.x)<2&&Math.abs(e.clientY-dblClickDetectArgs.y)<2&&!xxdialogMode&&null!=desktop&&isInputAllowed()&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousedblclick(e),desktop.m.sendKeepAlive()):desktop.m.mousedblclick(e)),dblClickDetectArgs.t=t,dblClickDetectArgs.x=e.clientX,dblClickDetectArgs.y=e.clientY)}function dmousedown(e){setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!xxdialogMode&&null!=desktop&&isInputAllowed()&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousedown(e),desktop.m.sendKeepAlive()):desktop.m.mousedown(e)),dblClickDetect(e)}function dmouseup(e){setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!xxdialogMode&&null!=desktop&&isInputAllowed()&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mouseup(e),desktop.m.sendKeepAlive()):desktop.m.mouseup(e))}function dmousemove(e){setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!xxdialogMode&&null!=desktop&&isInputAllowed()&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousemove(e),desktop.m.sendKeepAlive()):desktop.m.mousemove(e))}function dmousewheel(e){return setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!(xxdialogMode||null==desktop||!isInputAllowed()||(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousewheel(e),desktop.m.sendKeepAlive()):desktop.m.mousewheel&&desktop.m.mousewheel(e),haltEvent(e),0))}function drotate(e){xxdialogMode||null==desktop||(desktop.m.setRotation(desktop.m.rotation+e),deskAdjust(),deskAdjust())}function setupTerminal(){null!=terminal&&(terminal.Stop(),terminal=null),updateTerminalButtons();for(var e="",t=1;t<27;t++)e+="<option value='"+t+"'>Ctrl-"+String.fromCharCode(64+t)+" ("+t+")</option>";QH("specialkeylist",e)}function updateTerminalButtons(){var e=null!=terminal&&0!=terminal.state;QV("disconnectbutton2span",1==e),QV("connectbutton2span",0==e),QE("connectbutton2",!0),QE("ctrlcbutton",e),QE("ctrlxbutton",e),QE("escbutton",e),QE("bsbutton",e),QE("pastebutton",e),QE("specialkeylist",e),QE("specialkeylistinput",e),QV("terminalSettingsButtons",terminal&&2==terminal.contype),terminal&&(Q("id_ttypebutton").value=terminalEmulations[terminal.m.terminalEmulation],Q("id_tfxkeysbutton").value=fxEmulations[terminal.m.fxEmulation],Q("id_tcrbutton").value="\r\n"==terminal.m.lineFeed?"CR+LF":"LF");QV("termarea3xdiv",!0),QV("bsbutton",!1),QV("pastebutton",!1),QV("devListToolbarViewIcons2",!0),QE("termSizeList",null==terminal)}function onTerminalStateChange(e,t){var o=t,o=(3==o&&2==e.contype&&o++,StatusStrs[o]);switch(1==terminal.webRtcActive&&(o+=", WebRTC"),QH("termstatus",o),t){case 0:QH("termtitle",""),QV("termRecordIcon",!1),null==xterm?(e.m.TermResetScreen(),e.m.TermDraw()):(xterm.dispose(),xterm=xtermfit=null),null!=terminal&&(terminal.Stop(),terminal=null);break;case 3:e&&1==e.serverIsRecording&&QV("termRecordIcon",!0),terminal.startTime=new Date,null==updateSessionTimer&&(updateSessionTimer=setInterval(updateSessionTime,1e3)),null!=xterm&&xterm.focus()}updateTerminalButtons()}var autoConnectTerminalTimer=null;function autoConnectTerminal(e){autoConnectTerminalTimer=null==autoConnectTerminalTimer?setInterval(connectTerminal,100):(clearInterval(autoConnectTerminalTimer),null)}function CreateRemoteTunnel(e,t){var o={protocol:1};return null!=t&&"number"==typeof t.protocol&&(o.protocol=t.protocol),o.onTunnelUpdate=e,o.xxStateChange=function(e){},o.ProcessBinaryData=function(e){o.onTunnelUpdate(e)},o.ProcessData=function(e){o.onTunnelUpdate(e)},o.terminalEmulation=1,o.fxEmulation=0,o.lineFeed="\r\n",o}function tunnelUpdate(e){xterm.writeUtf8?"string"==typeof e?xterm.writeUtf8(e):xterm.writeUtf8(new Uint8Array(e)):"string"==typeof e?xterm.write(e):xterm.write(new Uint8Array(e))}function xTermSendResize(){(xtermResizeTimer=null)!=xterm&&null!=terminal&&null!=terminal.sendCtrlMsg&&terminal.sendCtrlMsg(JSON.stringify({ctrlChannel:"102938",type:"termsize",cols:xterm.cols,rows:xterm.rows}))}agentConsoleMessages=["","S'està esperant que l'usuari concedeixi l'accés...","Negat","No s'ha pogut iniciar la sessió del terminal remot, {0} ({1})","Temps mort","S'han rebut dades de xarxa no vàlides"];function formatAgentConsoleMessage(e,t,o){for(null==o&&(o=[]);o.length<3;)o.push("");return(t&&t<agentConsoleMessages.length?EscapeHtml(format(agentConsoleMessages[t],o[0],o[1],o[2])):EscapeHtml(e)).split("\n").join("<br />")+"<br /><br />"}function connectTerminal(e,t,o){p12clearConsoleMsg(),terminal?(terminal.Stop(),terminal=null):(null!=o&&"number"==typeof o.protocol&&o.protocol,o&&o.requireLogin,QV("termarea3xdiv",!0),null!=xterm&&xterm.dispose(),xtermfit=new FitAddon.FitAddon,xterm=new Terminal,xtermfit&&xterm.loadAddon(xtermfit),xterm.open(Q("termarea3xdiv")),xterm.onData(function(e){null!=terminal&&terminal.sendText(e)}),xtermfit&&xtermfit.fit(),xterm.onTitleChange(function(e){QH("termtitle"," - "+EscapeHtml(e))}),xterm.onResize(function(e){xtermResizeTimer&&clearTimeout(xtermResizeTimer),xtermResizeTimer=setTimeout(xTermSendResize,200)}),(terminal=CreateAgentRedirect(null,CreateRemoteTunnel(tunnelUpdate,o),serverPublicNamePort,authCookie,null,domainUrl)).debugmode=debugmode,terminal.m.debugmode=debugmode,terminal.options={cols:xterm.cols,rows:xterm.rows},o&&o.requireLogin&&(terminal.options.requireLogin=!0),terminal.Start(null),terminal.onStateChanged=onTerminalStateChange,terminal.contype=1,terminal.attemptWebRTC=!1,terminal.onConsoleMessageChange=function(e,t){terminal.consoleMessage?(Q("p12TermConsoleMsg").innerHTML+=formatAgentConsoleMessage(terminal.consoleMessage,terminal.consoleMessageId,terminal.consoleMessageArgs),QV("p12TermConsoleMsg",!0),null!=p12TermConsoleMsgTimer&&clearTimeout(p12TermConsoleMsgTimer),terminal.consoleMessageTimeout&&(p12TermConsoleMsgTimer=setTimeout(p12clearConsoleMsg,1e3*terminal.consoleMessageTimeout))):p12clearConsoleMsg()}),Q("connectbutton2").blur()}var terminalEmulations=["Terminal UTF8","ASCII estès","Intel ASCII"];function termToggleType(){terminal&&!xxdialogMode&&(terminal.m.terminalEmulation=(terminal.m.terminalEmulation+1)%3,Q("id_ttypebutton").value=terminalEmulations[terminal.m.terminalEmulation],Q("id_ttypebutton").blur())}var fxEmulations=["Intel (F10 = ESC+[OM)","Alternatiu (F10 = ESC+0)","VT100+ (F10 = ESC+[OY)"];function termToggleFx(){terminal&&!xxdialogMode&&(terminal.m.fxEmulation=(terminal.m.fxEmulation+1)%3,Q("id_tfxkeysbutton").value=fxEmulations[terminal.m.fxEmulation],Q("id_tfxkeysbutton").blur())}function termToggleCr(){terminal&&!xxdialogMode&&("\n"==terminal.m.lineFeed?terminal.m.lineFeed="\r\n":terminal.m.lineFeed="\n",Q("id_tcrbutton").value="\r\n"==terminal.m.lineFeed?"CR+LF":"LF")}function termSendKey(e,t){terminal&&!xxdialogMode&&(null!=xterm?(terminal.sendText?terminal.sendText(String.fromCharCode(e)):terminal.send(String.fromCharCode(e)),xterm.focus()):null!=terminal&&(terminal.m.TermSendKey(e),Q(t).blur()))}function showTermPasteDialog(){terminal&&!xxdialogMode&&(Q("pastebutton").blur(),setDialogMode(2,"Enganxa",3,showTermPasteDialogEx,'<textarea id=d2pasteText style="width:100%;height:184px;resize:none"></textarea>'),Q("d2pasteText").focus())}function showTermPasteDialogEx(){terminal&&terminal.m.TermSendKeys(Q("d2pasteText").value)}function sendSpecialKey(){null!=xterm?(terminal.sendText(String.fromCharCode(Q("specialkeylist").value)),xterm.focus()):null!=terminal&&(terminal.m.TermSendKey(Q("specialkeylist").value),Q("specialkeylist").blur(),Q("specialkeylistinput").blur())}function p12clearConsoleMsg(){QH("p12TermConsoleMsg",""),QV("p12TermConsoleMsg",!1),p12TermConsoleMsgTimer&&(clearTimeout(p12TermConsoleMsgTimer),p12TermConsoleMsgTimer=null)}function setupFiles(){null!=files&&(files.Stop(),files=null)}function onFilesStateChange(e,t){p13Connect.value=0==t?"Connecta't":"Desconnecta";var o=StatusStrs[t];switch(1==files.webRtcActive&&(o+=", WebRTC"),Q("p13Status").textContent=o,t){case 0:QH("p13files",""),p13filetree=null,p13filetreelocation=[],QH("p13currentpath",""),QE("p13FolderUp",!1),QV("filesRecordIcon",!1),p13setActions(),null!=files&&(files.Stop(),files=null),"fileMsgDialog"==xxdialogTag&&setDialogMode(0);break;case 3:p13targetpath="",files&&(files.sendText({action:"ls",reqid:1,path:""}),1==files.serverIsRecording)&&QV("filesRecordIcon",!0)}}function CreateRemoteFiles(e){var t={protocol:5};return t.onFileUpdate=e,t.xxStateChange=function(e){},t.ProcessData=function(e){t.onFileUpdate(e)},t}function connectFiles(e){p13clearConsoleMsg(),files?(files.Stop(),files=null):((files=CreateAgentRedirect(null,CreateRemoteFiles(p13gotFiles),serverPublicNamePort,authCookie,null,domainUrl)).attemptWebRTC=attemptWebRTC,files.onStateChanged=onFilesStateChange,files.onConsoleMessageChange=function(){files.consoleMessage?(Q("p13FilesConsoleMsg").innerHTML+=formatAgentConsoleMessage(files.consoleMessage,files.consoleMessageId,files.consoleMessageArgs),QV("p13FilesConsoleMsg",!0),null!=p13FilesConsoleMsgTimer&&clearTimeout(p13FilesConsoleMsgTimer),files.consoleMessageTimeout&&(p13FilesConsoleMsgTimer=setTimeout(p13clearConsoleMsg,1e3*files.consoleMessageTimeout))):p13clearConsoleMsg()},files.Start(null)),p13clipboard=p13clipboardFolder=null,p13clipboardCut=0,p13updateClipview()}var p13sortorder,p13filetree=null,p13targetpath=null,p13filetreelocation=[];function p13fileOperationDialogEx(e){0==e&&null!=files&&files.sendText({action:"cancel"})}function p13gotFiles(t){if(0<t.length&&123!=t.charCodeAt(0))p13gotDownloadBinaryData(t);else{try{t=JSON.parse(decode_utf8(t))}catch(e){t=JSON.parse(t)}if("download"==t.action)p13gotDownloadCommand(t);else if("findfile"==t.action)xxdialogTag==t.reqid&&(null==t.r?(QE("d2findFilter",!0),QE("filefind_dlgOkButton",!0),xxdialogTag=null,""==Q("d2findResults").innerHTML&&QH("d2findResults","<div style=text-align:center;margin:10px><i>No s'han trobat fitxers</i></div>")):QA("d2findResults","<div style=white-space:nowrap>"+EscapeHtml(t.r)+"</div>"));else if(null!=t.action&&t.action.startsWith("upload"))p13gotUploadData(t);else if("dialogmessage"==t.action)null==t.msg&&"fileMsgDialog"==xxdialogTag?setDialogMode(0):"zipping"!=t.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag?"zippingFile"!=t.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag||setDialogMode(2,"Operació de fitxers",10,p13fileOperationDialogEx,"<div style=margin:10px>"+EscapeHtml(t.file)+"<div><br /><progress value="+EscapeHtml(t.progress)+" style=width:100% max=100 />","fileMsgDialog"):setDialogMode(2,"Operació de fitxers",10,p13fileOperationDialogEx,"<div style=margin:10px>S'estan comprimint fitxers...<div>","fileMsgDialog");else if("refresh"==t.action)p13folderup(9999);else if(null!=t.path)if(t.path=t.path.replace(/\//g,"\\"),null!=p13filetree&&t.path==p13filetree.path){var e=p13getCheckedNames();p13filetree=t,p13updateFiles(e)}else{for(var o=t.path.replace(/\//g,"\\"),n=p13targetpath.replace(/\//g,"\\");0<o.length&&"\\"==o[0];)o=o.substring(1);for(;0<n.length&&"\\"==n[0];)n=n.substring(1);(o==n||"\\"==t.path&&""==p13targetpath)&&(p13filetree=t,p13updateFiles())}}}function p13getCheckedNames(){for(var e=[],t=document.getElementsByName("fd"),o=0;o<t.length;o++)t[o].checked&&e.push(p13filetree.dir[t[o].value].n);return e}function p13updateFiles(e){var t="",o="",n='<a href=# style=cursor:pointer onclick="return p13folderup(0)">Arrel</a>',l=p13filetree.path.split("\\");for(g in p13filetreelocation=[],l)""!=l[g]&&p13filetreelocation.push(l[g]);for(g in p13filetreelocation)n+=' / <a href=# style=cursor:pointer onclick="return p13folderup('+(parseInt(g)+1)+')">'+EscapeHtml(p13filetreelocation[g])+"</a>";var s=p13filetreelocation.join("/"),i=p13sort_files(p13filetree.dir);for(g in i){var a,r=i[g],d=p=r.n,p=(d=70<p.length?'<span title="'+EscapeHtml(p)+'">'+EscapeHtml(p.substring(0,70))+"...</span>":EscapeHtml(p),EscapeHtml(p)),u="",c=(null!=r.d&&(c=new Date(r.d),u=printDateTime(c="number"==typeof r.d?new Date(1e3*r.d):c)+"&nbsp;"),""),m=(null!=r.s&&(c=getFileSizeStr(r.s)),"");m=r.t<3?"<div class=filelist file=999><input file=999 style=float:left name=fd class=fcb type=checkbox onchange=p13setActions() value='"+r.nx+'\'>&nbsp;<span style=float:right title=""></span><span><div class=fileIcon'+r.t+' onclick=p13folderset("'+encodeURIComponentEx(r.nx)+'")></div><a href=# style=cursor:pointer onclick=\'return p13folderset("'+encodeURIComponentEx(r.nx)+"\")'>"+d+"</a></span></div>":(a=d,0<r.s&&(a='<a onclick=downloadFile("devicefile.ashx?c='+authCookie+"&f="+encodeURIComponentEx(s+"/"+p)+'","'+encodeURIComponentEx(p)+'") style=cursor:pointer>'+d+"</a>"),"<div id=fileEntry cmenu=filesContextMenu fileIndex="+g+" class=filelist file=3><input file=3 style=float:left name=fd class=fcb type=checkbox onchange=p13setActions() value='"+r.nx+"'>&nbsp;<span class=fsize>"+u+"</span><span style=float:right>"+EscapeHtml(c)+"</span><span><div class=fileIcon"+r.t+"></div>"+a+"</span></div>"),r.t<3?t+=m:o+=m}if(QH("p13files",t+o),QH("p13currentpath",n),QE("p13FolderUp",0!=p13filetreelocation.length),null!=e)for(var f=document.getElementsByName("fd"),g=0;g<f.length;g++)0<=e.indexOf(p13filetree.dir[f[g].value].n)&&(f[g].checked=!0);p13setActions()}function p13folderset(e){p13targetpath=joinPaths(p13filetree.path,p13filetree.dir[e].n).split("\\").join("/"),files.sendText({action:"ls",reqid:1,path:p13targetpath})}function p13folderup(e){if(null==e)p13filetreelocation.pop();else for(;p13filetreelocation.length>e;)p13filetreelocation.pop();return p13targetpath=p13filetreelocation.join("/"),files.sendText({action:"ls",reqid:1,path:p13targetpath}),!1}function p13findfile(){var e;xxdialogMode||(e=addHtmlValue("Filtre",'<input id=d2findFilter style="width:230px" onkeyup=p13findfileValidate() onkeydown=p13findfileDown(event) placeholder="*.txt"></input>'),setDialogMode(2,"Cerca fitxers",0,null,e=(e+='<div id=d2findResults style="width:100%;height:184px;background-color:white;border:1px solid black;padding:3px;overflow:scroll;margin-top:8px"></div>')+"<div style=margin-top:8px><input id=filefind_dlgCancelButton type=button value=Tanca style=float:right;width:80px;margin-left:5px onclick=p13findfileCancel()>"+"<input id=filefind_dlgOkButton type=submit value=Cerca style=float:right;width:80px onclick=p13findfileEx()><br /><br /></div>"),p13findfileValidate(),Q("d2findFilter").focus())}function p13findfileDown(e){"Entra"==e.code&&p13findfileEx()}function p13findfileValidate(){QE("filefind_dlgOkButton",0<Q("d2findFilter").value.length)}function p13findfileCancel(){null!=xxdialogTag&&files.sendText({action:"cancelfindfile",reqid:xxdialogTag}),dialogclose(0)}function p13findfileEx(e,t){var o;0!=Q("d2findFilter").value.length&&(o=p13filetreelocation.join("\\")+"\\",xxdialogTag="find:"+Math.random(),files.sendText({action:"findfile",reqid:xxdialogTag,path:o,filter:Q("d2findFilter").value}),QH("d2findResults",""),QE("d2findFilter",!1),QE("filefind_dlgOkButton",!1))}function p13sort_filename(e,t){return e.ln>t.ln?+p13sortorder:e.ln<t.ln?-1*p13sortorder:0}function p13sort_timestamp(e,t){return e.d>t.d?+p13sortorder:e.d<t.d?-1*p13sortorder:0}function p13sort_bysize(e,t){return e.s==t.s?p13sort_filename(e,t):(e.s-t.s)*p13sortorder}function p13sort_files(e){var t,o=[],n=Q("p13sortdropdown").value;for(t in e)e[t].nx=t,null==e[t].s&&(e[t].s=0),null==e[t].n&&(e[t].n=t),e[t].ln=e[t].n.toLowerCase(),o.push(e[t]);return p13sortorder=1,3<n&&(p13sortorder=-1,n-=3),1==n?o.sort(p13sort_filename):2==n?o.sort(p13sort_bysize):3==n&&o.sort(p13sort_timestamp),o}function p13setActions(){var e,t,o;null==p13filetree?(QE("p13DeleteFileButton",!1),QE("p13NewFolderButton",!1),QE("p13UploadButton",!1),QE("p13RenameFileButton",!1),QE("p13ViewFileButton",!1),QE("p13SelectAllButton",!1),Q("p13SelectAllButton").value="Seleccionar tot",QE("p13RefreshButton",!1),QE("p13FindButton",!1),QE("p13CutButton",!1),QE("p13CopyButton",!1),QE("p13ZipButton",!1),QE("p13PasteButton",!1)):(e=p13getFileSelCount(),t=p13getFileCount(),o=p13getFileSelCount(!1),QE("p13DeleteFileButton",0<e&&(0<p13filetreelocation.length||!1)),QE("p13NewFolderButton",0<p13filetreelocation.length||!1),QE("p13UploadButton",0<p13filetreelocation.length||!1),QE("p13RenameFileButton",1==e&&(0<p13filetreelocation.length||!1)),QE("p13ViewFileButton",1==e&&1==o&&(0<p13filetreelocation.length||!1)),QE("p13SelectAllButton",0<t),Q("p13SelectAllButton").value=0<e?"Seleccioneu Cap":"Seleccionar tot",QE("p13RefreshButton",!0),QE("p13FindButton",0<p13filetreelocation.length||!1),QE("p13CutButton",0<e&&e==o&&(0<p13filetreelocation.length||!1)),QE("p13CopyButton",0<e&&e==o&&(0<p13filetreelocation.length||!1)),QE("p13ZipButton",0<e&&(0<p13filetreelocation.length||!1)),QE("p13PasteButton",0<p13filetreelocation.length&&null!=p13clipboard&&0<p13clipboard.length))}function p13getFileSelCount(e){for(var t=0,o=document.getElementsByName("fd"),n=0;n<o.length;n++)!o[n].checked||0==e&&"3"!=o[n].attributes.file.value||t++;return t}function p13getFileSelDirCount(){for(var e=0,t=document.getElementsByName("fd"),o=0;o<t.length;o++)t[o].checked&&"999"==t[o].attributes.file.value&&e++;return e}function p13getFileCount(){return document.getElementsByName("fd").length}function p13selectallfile(){for(var e=0==p13getFileSelCount(),t=document.getElementsByName("fd"),o=0;o<t.length;o++)t[o].checked=e;p13setActions()}function p13createfolder(){setDialogMode(2,"Carpeta nova",3,p13createfolderEx,"<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% />"),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13createfolderEx(){files.sendText({action:"mkdir",reqid:1,path:p13filetreelocation.join("/")+"/"+Q("p13renameinput").value}),p13folderup(999)}function p13deletefile(){var e=p13getFileSelCount(),t=0<p13getFileSelDirCount()?"<br /><br /><label><input type=checkbox id=p13recdeleteinput>Eliminació recursiva</label><br>":"<input type=checkbox id=p13recdeleteinput style='display:none'>";setDialogMode(2,"Suprimeix",3,p13deletefileEx,1<e?format("Vols suprimir {0} elements seleccionats?",e)+t:"Vols suprimir l'element seleccionat?"+t)}function p13deletefileEx(){for(var e=[],t=document.getElementsByName("fd"),o=0;o<t.length;o++)t[o].checked&&e.push(p13filetree.dir[t[o].value].n);files.sendText({action:"rm",reqid:1,path:p13filetreelocation.join("/"),delfiles:e,rec:Q("p13recdeleteinput").checked}),p13folderup(999)}function p13renamefile(){for(var e,t=document.getElementsByName("fd"),o=0;o<t.length;o++)t[o].checked&&(e=p13filetree.dir[t[o].value].n);setDialogMode(2,"Canvia el nom",3,p13renamefileEx,'<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% value="'+e+'" />',{action:"rename",path:p13filetreelocation.join("/"),oldname:e}),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13renamefileEx(e,t){t.newname=Q("p13renameinput").value,files.sendText(t),p13folderup(999)}function p13fileNameCheck(e){var t=isFilenameValid(Q("p13renameinput").value);QE("idx_dlgOkButton",t),1==t&&null!=e&&13==e.keyCode&&dialogclose(1)}function p13uploadFile(){setDialogMode(2,"Penja el document",3,p13uploadFileEx,"<input type=file name=files id=p13uploadinput style=width:100% multiple=multiple onchange=\"updateUploadDialogOk('p13uploadinput')\" />"),updateUploadDialogOk("p13uploadinput")}function updateUploadDialogOk(e){QE("idx_dlgOkButton",0<Q("p13uploadinput").files.length)}function p13uploadFileEx(){p13doUploadFiles(Q("p13uploadinput").files)}function p13viewfile(){for(var e=document.getElementsByName("fd"),t=0;t<e.length;t++)if(e[t].checked){p13filetree.dir[e[t].value].s<=204800?p13downloadfile(encodeURIComponentEx(p13filetreelocation.join("/")+"/"+p13filetree.dir[e[t].value].n),encodeURIComponentEx(p13filetree.dir[e[t].value].n),p13filetree.dir[e[t].value].s,"viewer"):messagebox("Editor de fitxers","Només es poden editar fitxers de menys de 200 k.");break}}function p13zipFiles(){for(var e=[],t=document.getElementsByName("fd"),o=0;o<t.length;o++)t[o].checked&&e.push(p13filetree.dir[t[o].value].n);setDialogMode(2,"Nom del fitxer Zip",3,p13zipFilesEx,'<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% value="" />',{action:"zip -r",path:p13filetreelocation.join("/"),files:e}),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13zipFilesEx(e,t){t.output=Q("p13renameinput").value,t.output.toLowerCase().endsWith(".zip")||(t.output+=".zip"),files.sendText(t)}var p13clipboard=null,p13clipboardFolder=null,p13clipboardCut=0;function p13copyFile(e){var t=document.getElementsByName("fd");p13clipboard=[],p13clipboardCut=e,p13clipboardFolder=p13targetpath;for(var o=0;o<t.length;o++)t[o].checked&&"3"==t[o].attributes.file.value&&p13clipboard.push(p13filetree.dir[t[o].value].n);p13updateClipview()}function p13pasteFile(){var e="";setDialogMode(2,"Enganxa",3,p13pasteFileEx,e=null!=p13clipboard&&0<p13clipboard.length?0==p13clipboardCut?1<p13clipboard.length?format("Confirmeu la còpia de {0} entrades a aquesta ubicació?",p13clipboard.length):format("Vols confirmar la còpia d'1 entrada a aquesta ubicació?"):1<p13clipboard.length?format("Vols confirmar el moviment de {0} entrades a aquesta ubicació?",p13clipboard.length):format("Vols confirmar el moviment d'1 entrada a aquesta ubicació?"):e)}function p13pasteFileEx(){files.sendText({action:0==p13clipboardCut?"copy":"move",reqid:1,scpath:p13clipboardFolder,dspath:p13targetpath,names:p13clipboard}),p13folderup(999),1==p13clipboardCut&&(p13clipboardFolder=p13clipboard=null,p13clipboardCut=0,p13updateClipview())}function p13updateClipview(){var e="";null!=p13clipboard&&0<p13clipboard.length&&(e=0==p13clipboardCut?1<p13clipboard.length?format('Mantenint {0} entrades per copiar, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Clar</a>.',p13clipboard.length):format('Conté 1 entrada per copiar, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Clar</a>.'):1<p13clipboard.length?format('Mantingut {0} entrades per al moviment, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Clar</a>.',p13clipboard.length):format('Mantenint 1 entrada per al moviment, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Clar</a>.')),QH("p13bottomstatus",e),p13setActions()}function p13clearClip(){return p13clipboardFolder=p13clipboard=null,p13clipboardCut=0,p13updateClipview(),!1}function p13fileDragDrop(e){if(haltEvent(e),QV("p13bigfail",!1),QV("p13bigok",!1),null!=e.dataTransfer&&0!=e.dataTransfer.files.length&&null!=p13filetree){var t,o=[];for(t in e.dataTransfer.files)null!=e.dataTransfer.files[t].size&&0!=e.dataTransfer.files[t].size&&o.push(e.dataTransfer.files[t]);0!=o.length&&p13doUploadFiles(o)}}var gdownloadFile,p13dragtimer=null;function p13fileDragOver(e){haltEvent(e),null!=p13dragtimer&&(clearTimeout(p13dragtimer),p13dragtimer=null);e=null!=p13filetree;QV("p13bigok",e),QV("p13bigfail",!e)}function p13fileDragLeave(e){haltEvent(e),"p13filetable"!=e.target.id?(QV("p13bigfail",!1),QV("p13bigok",!1)):p13dragtimer=setTimeout(function(){QV("p13bigfail",!1),QV("p13bigok",!1),p13dragtimer=null},10)}function p13downloadfile(e,t,o,n){!xxdialogMode&&files&&(gdownloadFile={path:decodeURIComponent(e),file:decodeURIComponent(t),size:o,tsize:0,data:"",state:0,id:Math.random(),tag:n},files.sendText({action:"download",sub:"start",id:gdownloadFile.id,path:gdownloadFile.path}),setDialogMode(2,"Descarrega l'arxiu",10,p13downloadFileCancel,"<div>"+gdownloadFile.file+"</div><br /><progress id=d2progressBar style=width:100% value=0 max="+o+" />"))}function p13downloadFileCancel(){setDialogMode(0),files.sendText({action:"download",sub:"cancel",id:gdownloadFile.id}),gdownloadFile=null}function p13gotDownloadCommand(e){null!=gdownloadFile&&e.id==gdownloadFile.id&&("start"==e.sub?(gdownloadFile.state=1,files.sendText({action:"download",sub:"startack",id:gdownloadFile.id})):"cancel"==e.sub&&(gdownloadFile=null,setDialogMode(0)))}function p13gotDownloadBinaryData(e){gdownloadFile&&0!=gdownloadFile.state&&(4<e.length&&(gdownloadFile.tsize+=e.length-4,gdownloadFile.data+=e.substring(4),Q("d2progressBar").value=gdownloadFile.tsize),0!=(1&ReadInt(e,0))?"viewer"==gdownloadFile.tag?(setDialogMode(4,EscapeHtml(gdownloadFile.file),3,p13editSaveBack,null,gdownloadFile.file),QS("dialog").width="auto",QS("dialog").bottom="80px",QS("dialog").top=QS("dialog").left=QS("dialog").right="100px",Q("d4editorarea").value=gdownloadFile.data,gdownloadFile=null):(saveAs(data2blob(gdownloadFile.data),gdownloadFile.file),gdownloadFile=null,setDialogMode(0)):files.sendText({action:"download",sub:"ack",id:gdownloadFile.id}))}var uploadFile,d4EditWrapVal=0,d4EditSizeVal=0;function d4ToggleWrap(e){e||(d4EditWrapVal=++d4EditWrapVal%2),Q("d4WrapButton").value=["Embolcall: ON","Embolcall: OFF"][d4EditWrapVal],QS("d4editorarea").overflow=0==d4EditWrapVal?"auto":"scroll",QS("d4editorarea")["white-space"]=0==d4EditWrapVal?null:"pre",putstore("editorWrap",d4EditWrapVal)}function d4ToggleSize(e){e||(d4EditSizeVal=++d4EditSizeVal%4),QS("d4editorarea")["font-size"]=["100%","125%","150%","200%"][d4EditSizeVal],Q("d4SizeButton").value=["Mida: 100%","Mida: 125%","Mida: 150%","Mida: 200%"][d4EditSizeVal],putstore("editorSize",d4EditSizeVal)}function p13editSaveBack(e,t){var o=(new TextEncoder).encode(Q("d4editorarea").value);p13uploadFileContinue(1,[{name:t,size:o.byteLength,type:"text/plain",xdata:o}])}function p13doUploadFiles(e){if(!xxdialogMode){var t=[],o=0;for(n in p13filetree.dir)t.push(p13filetree.dir[n].n.toLowerCase());for(var n=0;n<e.length;n++)0<=t.indexOf(e[n].name.toLowerCase())&&o++;0==o?p13uploadFileContinue(1,e):setDialogMode(2,"Penja el document",3,p13uploadFileContinue,format(1==o?"La càrrega sobreescriurà 1 fitxer. Continuar?":"La càrrega sobreescriurà {0} fitxers. Continuar?",o),e)}}function p13uploadFileContinue(e,t){(uploadFile={}).xpath=p13filetreelocation.join("/"),uploadFile.xfiles=t,uploadFile.xfilePtr=-1,setDialogMode(2,"Penja el document",10,p13uploadFileCancel,"<div id=p13dfileName>Connectant...</div><br /><progress id=d2progressBar style=width:100% value=0 max=0 />"),p13uploadNextFile()}let byteToHex=[];for(var xxdialogMode,xxdialogFunc,xxdialogButtons,xxdialogTag,n=0;n<=255;++n){var hexOctet=n.toString(16).padStart(2,"0");byteToHex.push(hexOctet)}function arrayBufferToHex(e){return Array.prototype.map.call(new Uint8Array(e),e=>byteToHex[e]).join("")}function performHash(e,t){window.crypto.subtle.digest("SHA-384",e).then(function(e){t(arrayBufferToHex(e))},function(){t(null)})}function p13uploadNextFile(){var o;uploadFile.xfilePtr++,uploadFile.xfiles.length>uploadFile.xfilePtr?(uploadFile.xptr=0,o=uploadFile.xfiles[uploadFile.xfilePtr],QH("p13dfileName",o.name),Q("d2progressBar").max=o.size,Q("d2progressBar").value=0,null==o.xdata?(uploadFile.xreader=new FileReader,uploadFile.xreader.onload=function(){uploadFile.xdata=uploadFile.xreader.result;var e,t=null;for(e in p13filetree.dir)p13filetree.dir[e].n==o.name&&(t=p13filetree.dir[e]);null!=t&&t.s<=uploadFile.xreader.result.byteLength?performHash(uploadFile.xreader.result.slice(0,t.s),function(e){files.sendText(JSON.stringify({action:"uploadhash",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:o.name,tag:{h:e.toUpperCase(),s:t.s,skip:t.s==uploadFile.xreader.result.byteLength}}))}):files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:o.name,size:uploadFile.xdata.byteLength}))},uploadFile.xreader.readAsArrayBuffer(o)):(uploadFile.xdata=o.xdata,files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:o.name,size:uploadFile.xdata.byteLength})))):p13uploadFileTransferDone()}function p13uploadFileCancel(e,t){null!=uploadFile&&(files.sendText(JSON.stringify({action:"uploadcancel",reqid:uploadFile.xfilePtr})),uploadFile=null),p13uploadFileTransferDone()}function p13uploadFileTransferDone(){uploadFile=null,setDialogMode(0),p13folderup(9999)}function p13gotUploadData(e){if(null!=uploadFile&&parseInt(uploadFile.xfilePtr)==parseInt(e.reqid))switch(e.action){case"uploadstart":p13uploadNextPart(!1);for(var t=0;t<8;t++)p13uploadNextPart(!0);break;case"uploadack":p13uploadNextPart(!1);break;case"uploaddone":(uploadFile.xfiles.length>uploadFile.xfilePtr+1?p13uploadNextFile:p13uploadFileTransferDone)();break;case"uploaderror":p13uploadFileCancel();break;case"uploadhash":var o=uploadFile.xfiles[uploadFile.xfilePtr];o&&(e.tag.h===e.hash?e.tag.skip?p13uploadNextFile():(uploadFile.xptr=e.tag.s,files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:o.name,size:uploadFile.xdata.byteLength,append:!0}))):files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:o.name,size:uploadFile.xdata.byteLength,append:!1})))}}function p13uploadNextPart(e){var t=uploadFile.xdata,o=uploadFile.xptr;if(o>=t.byteLength)files.sendText(JSON.stringify({action:"uploaddone",reqid:uploadFile.xfilePtr}));else{var n=uploadFile.xptr+65565;if(t.byteLength<n){if(1==e)return;n=t.byteLength}e=new Uint8Array(t.slice(o,n));123==e[0]||0==e[0]?((t=new Uint8Array(n-o+1)).set(e,1),files.send(t)):files.send(e),uploadFile.xptr=n,Q("d2progressBar").value=n}}var xxcurrentView=-1;function setDialogMode(e,t,o,n,l,s){xxdialogMode=e,xxdialogFunc=n,xxdialogButtons=o,xxdialogTag=s,QE("idx_dlgOkButton",!0),QV("idx_dlgOkButton",1&o),QV("idx_dlgCancelButton",2&o),QV("id_dialogclose",2&o||8&o),QV("idx_dlgDeleteButton",4&o),QV("idx_dlgButtonBar",7&o),t&&QH("id_dialogtitle",t);for(var i=1;i<8;i++)QV("dialog"+i,i==e);QV("dialog",e),l&&(2==e?QH("id_dialogOptions",l):QH("id_dialogMessage",l))}function dialogclose(e){var t=xxdialogFunc,o=xxdialogButtons,n=xxdialogTag;setDialogMode(),(8&o||e)&&t&&t(e,n)}function go(e){if(!xxdialogMode){QV("p11",11==e),QV("p12",12==e),QV("p13",13==e);var t,o=["LeftMenuDesktop","LeftMenuTerminal","LeftMenuFiles"];for(t in o)Q(o[t]).classList.remove("slbbuttonsel"),Q(o[t]).classList.remove("slbbuttonsel2");11==e&&Q("LeftMenuDesktop").classList.add("slbbuttonsel2"),12==e&&Q("LeftMenuTerminal").classList.add("slbbuttonsel2"),13==e&&Q("LeftMenuFiles").classList.add("slbbuttonsel2"),xxcurrentView=e}}function messagebox(e,t){setSessionActivity(),QH("id_dialogMessage",t),setDialogMode(1,e,1)}function statusbox(e,t){setSessionActivity(),QH("id_dialogMessage",t),setDialogMode(1,e)}function haltEvent(e){return e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1}function pad2(e){e="00"+e;return e.substr(e.length-2)}function format(e){var o=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,t){return void 0!==o[t]?o[t]:e})}function setSessionActivity(){sessionActivity=Date.now()}function printDate(e){return e.toLocaleDateString(urlargs.locale)}function printTime(e){return e.toLocaleTimeString(urlargs.locale)}function printDateTime(e){return e.toLocaleString(urlargs.locale)}function printFlexDateTime(e){return printDate(new Date)==printDate(e)?format("Caduca a les {0}",printTime(e)):format("Caduca el dia {0}",printDateTime(e))}function getFileSizeStr(e){return 1==(e="number"!=typeof e?0:e)?"1 byte":format("{0} bytes",e)}function encodeURIComponentEx(e){return encodeURIComponent(e).replace(/'/g,"%27")}function joinPaths(){var e,t=[];for(e in arguments){var o=arguments[e];if(null!=o&&""!=o){for(;o.endsWith("/")||o.endsWith("\\");)o=o.substring(0,o.length-1);for(;o.startsWith("/")||o.startsWith("\\");)o=o.substring(1);t.push(o)}}return t.join("/")}function focusTextBox(e){setTimeout(function(){Q(e).selectionStart=Q(e).selectionEnd=65535,Q(e).focus()},0)}var isFilenameValid=function(){var t=/^[^\\/:\*\?"<>\|]+$/,o=/^\./,n=/^(nul|prn|con|lpt[0-9]|com[0-9])(\.|$)/i;return function(e){return t.test(e)&&!o.test(e)&&!n.test(e)&&"."!=e[0]}}();function downloadFile(e,t,o){var n=document.createElement("a");n.setAttribute("href",e),n.setAttribute("rel","noreferrer noopener"),n.setAttribute("target","fileDownloadFrame"),0<=navigator.userAgent.indexOf("Firefox")&&n.setAttribute("download",decodeURIComponent(t||"")),document.body.appendChild(n),n.click(),document.body.removeChild(n),o&&setDialogMode(0)}start()</script>